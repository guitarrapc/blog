---
Title: PowerShell For / Foreach / Foreach-Object / ScriptBlock / Filter - Benchmark
  2013
Category:
- PowerShell
Date: 2013-03-09T19:03:18+09:00
URL: https://tech.guitarrapc.com/entry/2013/03/09/190318
EditURL: https://blog.hatena.ne.jp/guitarrapc_tech/guitarrapc-tech.hatenablog.com/atom/entry/11696248318757675557
CustomPath: 2013/03/09/190318_2
---

<p>There is C# benchmark for For VS Foreach. It was very interesting to use in code.</p>
<blockquote><a href="http://www.codeproject.com/Tips/531893/For-Vs-Foreach-Benchmark-2013" target="_blank">C# - For Vs Foreach - Benchmark 2013</a></blockquote>
<h2>Introduction</h2>
<p>I could not found greate article for "Which is better practive among "For" VS "Foreach" in PowerShell". I believe there should be some point of view about it, but let's try benchmark int with way how original C# site doing. What about PowerShelll 1.0 and 2.0? Sorry but please forgive me only about PowerShell 3.0.</p>
<h2>Target</h2>
<p>Like other program languages, PowerShell also have several Loop and I have decided to do benchmark, to compare the perfomance with <code>for</code>, <code>foreach</code>, <code>Foreach-Object</code> Cmdlet, <code>ScriptBlock</code> and <code>filter</code>.</p>
<pre class="brush: powershell">for
foreach
Foreach-Object
ScriptBlock
Filter
</pre>
<p>As you know, they wrote like this in PowerShell.</p>
<pre class="brush: powershell">for (&lt;Initialization Pipeline&gt;; &lt;Evaluate Pipeline&gt;;&lt;increment Pipeline&gt;){&lt; Sentence &gt;}
foreach (&lt;Variable&gt; in &lt;Loop Pipeline&gt;){&lt; Sentence&gt;}
&lt;Parameter&gt; | Foreach-Object {begin}{process}{end}
&amp;{Sentence}
filter &lt;Name&gt;{param(&lt;List of Parameter&gt;) &lt;Sentence&gt;}
</pre>
<h2>The Benchmark Result</h2>
<p>Followed Original site.</p>
<blockquote>Measured in miliseconds Collection length: 30000000</blockquote>
<table border="0" width="819" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td align="left" width="107" height="21">Data Type</td>
<td align="left" width="141">Collection Type</td>
<td align="left" width="133">Loop Type</td>
<td align="left" width="107">Test 1</td>
<td align="left" width="107">Test 2</td>
<td align="left" width="117">Test 3</td>
<td align="left" width="107">Average</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td rowspan="5">int[]</td>
<td align="left">For</td>
<td align="right">275899.00</td>
<td align="right">265212.00</td>
<td align="right">283013.40</td>
<td align="right">274708.13</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">Foreach</td>
<td align="right">186429.45</td>
<td align="right">176947.98</td>
<td align="right">198700.93</td>
<td align="right">187359.46</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">Foreach-Object</td>
<td align="right">1050280.06</td>
<td align="right">1055265.18</td>
<td align="right">1035663.52</td>
<td align="right">1047069.58</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">ScriptBlock</td>
<td align="right">227393.92</td>
<td align="right">240253.13</td>
<td align="right">224370.40</td>
<td align="right">230672.48</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">Filter</td>
<td align="right">237666.43</td>
<td align="right">233423.09</td>
<td align="right">233057.27</td>
<td align="right">234715.60</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td rowspan="5">List&lt;int&gt;</td>
<td align="left">For</td>
<td align="right">340137.03</td>
<td align="right">355315.28</td>
<td align="right">335932.48</td>
<td align="right">343794.93</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">Foreach</td>
<td align="right">241257.27</td>
<td align="right">260461.74</td>
<td align="right">240227.87</td>
<td align="right">247315.63</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">Foreach-Object</td>
<td align="right">1160124.71</td>
<td align="right">1290480.25</td>
<td align="right">1156974.90</td>
<td align="right">1202526.62</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">ScriptBlock</td>
<td align="right">300991.85</td>
<td align="right">322849.46</td>
<td align="right">295052.61</td>
<td align="right">306297.97</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">Filter</td>
<td align="right">342645.71</td>
<td align="right">308032.91</td>
<td align="right">348444.29</td>
<td align="right">347944.69</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td rowspan="5">ArrayList&lt;int&gt;</td>
<td align="left">For</td>
<td align="right">258247.16</td>
<td align="right">280059.96</td>
<td align="right">272251.21</td>
<td align="right">270186.11</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">Foreach</td>
<td align="right">162259.60</td>
<td align="right">174109.73</td>
<td align="right">172552.03</td>
<td align="right">169640.45</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">Foreach-Object</td>
<td align="right">997676.13</td>
<td align="right">1079849.90</td>
<td align="right">1057534.18</td>
<td align="right">1045020.07</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">ScriptBlock</td>
<td align="right">209276.20</td>
<td align="right">232152.56</td>
<td align="right">214621.41</td>
<td align="right">218683.39</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">Filter</td>
<td align="right">229675.65</td>
<td align="right">230850.35</td>
<td align="right">231555.98</td>
<td align="right">231299.99  </td>
</tr>
</tbody>
</table>
<h2>Conclusion</h2>
<h3>Speed of Collections</h3>
<ol>
<li>ArrayList (Fastest)</li>
<li>int[]</li>
<li>List (Slowest)</li>
</ol>
<h3>Data Type - Operation</h3>
<p>All Datatype shows same disposition.</p>
<ul>
<li><strong>int[] (Array)</strong></li>
<li><strong>List</strong></li>
<li><strong>ArrayList</strong></li>
</ul>
<p>Foreach is the fastest, almost no difference between ScriptBlock and Filter. Foreach-Object seeems obviously slow.</p>
<ol>
<li>Foreach (Fastest)</li>
<li>ScriptBlock</li>
<li>Filter</li>
<li>Foreach-Object (Slowest)</li>
</ol>
<h3>Which Loop type to be use</h3>
<p>I should note such a cost for Foreach-Object Cmdlet.</p>
<table border="0" width="579" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td align="left" width="79" height="21">Data Type</td>
<td align="left" width="72">Collection Type</td>
<td align="left" width="107">Loop Type</td>
<td align="left" width="107">Average</td>
<td align="left" width="107">v.s. int[] For</td>
<td align="left" width="107">v.s. int[]</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td rowspan="5">int[]</td>
<td align="left">For</td>
<td align="right">274708.13</td>
<td align="left">-</td>
<td align="left">-</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">Foreach</td>
<td align="right">187359.46</td>
<td align="right">68.20%</td>
<td align="left">-</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">Foreach-Object</td>
<td align="right">1047069.58</td>
<td align="right">381.16%</td>
<td align="left">-</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">ScriptBlock</td>
<td align="right">230672.48</td>
<td align="right">83.97%</td>
<td align="left">-</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">Filter</td>
<td align="right">234715.60</td>
<td align="right">85.44%</td>
<td align="left">-</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td rowspan="5">List&lt;int&gt;</td>
<td align="left">For</td>
<td align="right">343794.93</td>
<td align="right">125.15%</td>
<td align="right">125.15%</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">Foreach</td>
<td align="right">247315.63</td>
<td align="right">90.03%</td>
<td align="right">132.00%</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">Foreach-Object</td>
<td align="right">1202526.62</td>
<td align="right">437.75%</td>
<td align="right">114.85%</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">ScriptBlock</td>
<td align="right">306297.97</td>
<td align="right">111.50%</td>
<td align="right">132.78%</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">Filter</td>
<td align="right">347944.69</td>
<td align="right">126.66%</td>
<td align="right">148.24%</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td rowspan="5">ArrayList&lt;int&gt;</td>
<td align="left">For</td>
<td align="right">270186.11</td>
<td align="right">98.35%</td>
<td align="right">98.35%</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">Foreach</td>
<td align="right">169640.45</td>
<td align="right">61.75%</td>
<td align="right">90.54%</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">Foreach-Object</td>
<td align="right">1045020.07</td>
<td align="right">380.41%</td>
<td align="right">99.80%</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">ScriptBlock</td>
<td align="right">218683.39</td>
<td align="right">79.61%</td>
<td align="right">94.80%</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">Filter</td>
<td align="right">231299.99</td>
<td align="right">84.20%</td>
<td align="right">98.54%</td>
</tr>
</tbody>
</table>
<p>It takes time V.S. "4 times of for", "5-6 time of foeach" and "4-4.5 time of ScriptBlock/Filter". Also ScriptBlock was next position of foreach and Filter shows almost same speed. I thought In-Action said Foreach-Object was just a one type of Filter, but benchmark result in it isn't. Filter should be takes cost for ScriptBlock {process{}} + set into PSObject:Function and was called. I don't to write foreach that foreach couldn't use in Pipeline, but now we can put Filter in alter choice. So I recomend as ...</p>
<blockquote>
<ul>
<li>foreach : for huge data like Log file and when it doesn't need to use the Pipeline.</li>
<li>Filter : It data was quite big but requried to use the Pipeline.</li>
<li>ScriptBlock : When using standalone, I mean not for the Pipeline or foreach statesment.</li>
<li>Foreach-Object : When required to pass Object through the Pipeline, also data was small and speed should be not considerble.</li>
</ul>
</blockquote>
<h3>How about Collection size to take cost take exponential</h3>
<p>There is no exponential trend but only propotion to Collection size. You can estimate time spend.</p>
<ol>
<li>Foreach (Fastest)</li>
<li>ScriptBlock</li>
<li>Filter</li>
<li>Foreach-Object (Slowest)</li>
</ol>
<p>Here's result with Collection size for 10,100,1000,10000,100000,1000000.</p>
<blockquote>Measured in miliseconds Collection length: 10</blockquote>
<table border="0" width="819" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td align="left" width="107" height="21">Data Type</td>
<td align="left" width="141">Collection Type</td>
<td align="left" width="133">Loop Type</td>
<td align="left" width="107">Test 1</td>
<td align="left" width="107">Test 2</td>
<td align="left" width="117">Test 3</td>
<td align="left" width="107">Average</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">int[]</td>
<td align="left">For</td>
<td align="right">0.15</td>
<td align="right">0.22</td>
<td align="right">0.21</td>
<td align="right">0.19</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">int[]</td>
<td align="left">Foreach</td>
<td align="right">0.24</td>
<td align="right">0.15</td>
<td align="right">0.11</td>
<td align="right">0.17</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">int[]</td>
<td align="left">Foreach-Object</td>
<td align="right">0.57</td>
<td align="right">0.62</td>
<td align="right">0.67</td>
<td align="right">0.62</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">int[]</td>
<td align="left">ScriptBlock</td>
<td align="right">0.19</td>
<td align="right">0.26</td>
<td align="right">0.22</td>
<td align="right">0.22</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">int[]</td>
<td align="left">Filter</td>
<td align="right">0.21</td>
<td align="right">0.20</td>
<td align="right">0.19</td>
<td align="right">0.20</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">List&lt;int&gt;</td>
<td align="left">For</td>
<td align="right">0.19</td>
<td align="right">0.24</td>
<td align="right">0.16</td>
<td align="right">0.20</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">List&lt;int&gt;</td>
<td align="left">Foreach</td>
<td align="right">0.13</td>
<td align="right">0.33</td>
<td align="right">0.13</td>
<td align="right">0.19</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">List&lt;int&gt;</td>
<td align="left">Foreach-Object</td>
<td align="right">0.48</td>
<td align="right">0.66</td>
<td align="right">0.64</td>
<td align="right">0.59</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">List&lt;int&gt;</td>
<td align="left">ScriptBlock</td>
<td align="right">0.30</td>
<td align="right">0.28</td>
<td align="right">0.24</td>
<td align="right">0.27</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">List&lt;int&gt;</td>
<td align="left">Filter</td>
<td align="right">0.34</td>
<td align="right">0.18</td>
<td align="right">0.19</td>
<td align="right">0.24</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">ArrayList&lt;int&gt;</td>
<td align="left">For</td>
<td align="right">0.12</td>
<td align="right">0.23</td>
<td align="right">0.13</td>
<td align="right">0.16</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">ArrayList&lt;int&gt;</td>
<td align="left">Foreach</td>
<td align="right">0.09</td>
<td align="right">0.19</td>
<td align="right">0.10</td>
<td align="right">0.13</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">ArrayList&lt;int&gt;</td>
<td align="left">Foreach-Object</td>
<td align="right">0.42</td>
<td align="right">0.77</td>
<td align="right">0.50</td>
<td align="right">0.56</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">ArrayList&lt;int&gt;</td>
<td align="left">ScriptBlock</td>
<td align="right">0.15</td>
<td align="right">0.25</td>
<td align="right">0.20</td>
<td align="right">0.20</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">ArrayList&lt;int&gt;</td>
<td align="left">Filter</td>
<td align="right">0.16</td>
<td align="right">0.19</td>
<td align="right">0.15</td>
<td align="right">0.17</td>
</tr>
</tbody>
</table>
<p> </p>
<blockquote>Measured in miliseconds Collection length: 100</blockquote>
<table border="0" width="819" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td align="left" width="107" height="21">Data Type</td>
<td align="left" width="141">Collection Type</td>
<td align="left" width="133">Loop Type</td>
<td align="left" width="107">Test 1</td>
<td align="left" width="107">Test 2</td>
<td align="left" width="117">Test 3</td>
<td align="left" width="107">Average</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">int[]</td>
<td align="left">For</td>
<td align="right">1.08</td>
<td align="right">0.90</td>
<td align="right">1.08</td>
<td align="right">1.02</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">int[]</td>
<td align="left">Foreach</td>
<td align="right">0.66</td>
<td align="right">0.67</td>
<td align="right">0.69</td>
<td align="right">0.67</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">int[]</td>
<td align="left">Foreach-Object</td>
<td align="right">3.64</td>
<td align="right">3.49</td>
<td align="right">3.59</td>
<td align="right">3.57</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">int[]</td>
<td align="left">ScriptBlock</td>
<td align="right">0.94</td>
<td align="right">0.85</td>
<td align="right">0.96</td>
<td align="right">0.91</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">int[]</td>
<td align="left">Filter</td>
<td align="right">1.02</td>
<td align="right">1.07</td>
<td align="right">1.05</td>
<td align="right">1.05</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">List&lt;int&gt;</td>
<td align="left">For</td>
<td align="right">1.24</td>
<td align="right">1.15</td>
<td align="right">1.17</td>
<td align="right">1.19</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">List&lt;int&gt;</td>
<td align="left">Foreach</td>
<td align="right">0.92</td>
<td align="right">2.91</td>
<td align="right">0.97</td>
<td align="right">1.60</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">List&lt;int&gt;</td>
<td align="left">Foreach-Object</td>
<td align="right">7.69</td>
<td align="right">4.48</td>
<td align="right">4.21</td>
<td align="right">5.46</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">List&lt;int&gt;</td>
<td align="left">ScriptBlock</td>
<td align="right">1.16</td>
<td align="right">1.20</td>
<td align="right">1.07</td>
<td align="right">1.14</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">List&lt;int&gt;</td>
<td align="left">Filter</td>
<td align="right">1.26</td>
<td align="right">1.25</td>
<td align="right">1.05</td>
<td align="right">1.19</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">ArrayList&lt;int&gt;</td>
<td align="left">For</td>
<td align="right">1.01</td>
<td align="right">0.99</td>
<td align="right">1.13</td>
<td align="right">1.04</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">ArrayList&lt;int&gt;</td>
<td align="left">Foreach</td>
<td align="right">0.67</td>
<td align="right">0.77</td>
<td align="right">0.57</td>
<td align="right">0.67</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">ArrayList&lt;int&gt;</td>
<td align="left">Foreach-Object</td>
<td align="right">8.37</td>
<td align="right">3.50</td>
<td align="right">3.52</td>
<td align="right">5.13</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">ArrayList&lt;int&gt;</td>
<td align="left">ScriptBlock</td>
<td align="right">0.76</td>
<td align="right">0.79</td>
<td align="right">0.75</td>
<td align="right">0.77</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">ArrayList&lt;int&gt;</td>
<td align="left">Filter</td>
<td align="right">0.75</td>
<td align="right">0.97</td>
<td align="right">0.78</td>
<td align="right">0.84</td>
</tr>
</tbody>
</table>
<p> </p>
<blockquote>Measured in miliseconds Collection length: 1000</blockquote>
<table border="0" width="819" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td align="left" width="107" height="21">Data Type</td>
<td align="left" width="141">Collection Type</td>
<td align="left" width="133">Loop Type</td>
<td align="left" width="107">Test 1</td>
<td align="left" width="107">Test 2</td>
<td align="left" width="117">Test 3</td>
<td align="left" width="107">Average</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">int[]</td>
<td align="left">For</td>
<td align="right">13.13</td>
<td align="right">12.11</td>
<td align="right">10.33</td>
<td align="right">11.86</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">int[]</td>
<td align="left">Foreach</td>
<td align="right">7.38</td>
<td align="right">6.54</td>
<td align="right">6.70</td>
<td align="right">6.88</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">int[]</td>
<td align="left">Foreach-Object</td>
<td align="right">41.38</td>
<td align="right">39.61</td>
<td align="right">37.85</td>
<td align="right">39.61</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">int[]</td>
<td align="left">ScriptBlock</td>
<td align="right">10.03</td>
<td align="right">8.14</td>
<td align="right">10.27</td>
<td align="right">9.48</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">int[]</td>
<td align="left">Filter</td>
<td align="right">8.97</td>
<td align="right">9.04</td>
<td align="right">7.33</td>
<td align="right">8.45</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">List&lt;int&gt;</td>
<td align="left">For</td>
<td align="right">15.10</td>
<td align="right">12.45</td>
<td align="right">13.04</td>
<td align="right">13.53</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">List&lt;int&gt;</td>
<td align="left">Foreach</td>
<td align="right">9.94</td>
<td align="right">9.86</td>
<td align="right">8.30</td>
<td align="right">9.37</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">List&lt;int&gt;</td>
<td align="left">Foreach-Object</td>
<td align="right">45.20</td>
<td align="right">41.35</td>
<td align="right">44.35</td>
<td align="right">43.63</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">List&lt;int&gt;</td>
<td align="left">ScriptBlock</td>
<td align="right">12.36</td>
<td align="right">10.13</td>
<td align="right">10.42</td>
<td align="right">10.97</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">List&lt;int&gt;</td>
<td align="left">Filter</td>
<td align="right">12.11</td>
<td align="right">10.80</td>
<td align="right">9.74</td>
<td align="right">10.88</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">ArrayList&lt;int&gt;</td>
<td align="left">For</td>
<td align="right">9.13</td>
<td align="right">9.46</td>
<td align="right">11.98</td>
<td align="right">10.19</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">ArrayList&lt;int&gt;</td>
<td align="left">Foreach</td>
<td align="right">6.23</td>
<td align="right">6.95</td>
<td align="right">6.35</td>
<td align="right">6.51</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">ArrayList&lt;int&gt;</td>
<td align="left">Foreach-Object</td>
<td align="right">39.64</td>
<td align="right">40.04</td>
<td align="right">37.64</td>
<td align="right">39.11</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">ArrayList&lt;int&gt;</td>
<td align="left">ScriptBlock</td>
<td align="right">7.65</td>
<td align="right">7.15</td>
<td align="right">7.17</td>
<td align="right">7.32</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">ArrayList&lt;int&gt;</td>
<td align="left">Filter</td>
<td align="right">6.92</td>
<td align="right">7.19</td>
<td align="right">9.17</td>
<td align="right">7.76</td>
</tr>
</tbody>
</table>
<p> </p>
<blockquote>Measured in miliseconds Collection length: 10000</blockquote>
<table border="0" width="819" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td align="left" width="107" height="21">Data Type</td>
<td align="left" width="141">Collection Type</td>
<td align="left" width="133">Loop Type</td>
<td align="left" width="107">Test 1</td>
<td align="left" width="107">Test 2</td>
<td align="left" width="117">Test 3</td>
<td align="left" width="107">Average</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">int[]</td>
<td align="left">For</td>
<td align="right">105.29</td>
<td align="right">100.37</td>
<td align="right">97.21</td>
<td align="right">100.95</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">int[]</td>
<td align="left">Foreach</td>
<td align="right">68.30</td>
<td align="right">66.19</td>
<td align="right">65.25</td>
<td align="right">66.58</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">int[]</td>
<td align="left">Foreach-Object</td>
<td align="right">386.23</td>
<td align="right">367.49</td>
<td align="right">377.58</td>
<td align="right">377.10</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">int[]</td>
<td align="left">ScriptBlock</td>
<td align="right">87.87</td>
<td align="right">80.90</td>
<td align="right">83.52</td>
<td align="right">84.10</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">int[]</td>
<td align="left">Filter</td>
<td align="right">84.34</td>
<td align="right">82.42</td>
<td align="right">80.99</td>
<td align="right">82.58</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">List&lt;int&gt;</td>
<td align="left">For</td>
<td align="right">132.17</td>
<td align="right">125.16</td>
<td align="right">121.24</td>
<td align="right">126.19</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">List&lt;int&gt;</td>
<td align="left">Foreach</td>
<td align="right">90.14</td>
<td align="right">88.64</td>
<td align="right">87.66</td>
<td align="right">88.81</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">List&lt;int&gt;</td>
<td align="left">Foreach-Object</td>
<td align="right">425.56</td>
<td align="right">427.77</td>
<td align="right">417.71</td>
<td align="right">423.68</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">List&lt;int&gt;</td>
<td align="left">ScriptBlock</td>
<td align="right">112.23</td>
<td align="right">107.41</td>
<td align="right">108.86</td>
<td align="right">109.50</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">List&lt;int&gt;</td>
<td align="left">Filter</td>
<td align="right">102.32</td>
<td align="right">143.87</td>
<td align="right">104.03</td>
<td align="right">116.74</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">ArrayList&lt;int&gt;</td>
<td align="left">For</td>
<td align="right">102.66</td>
<td align="right">94.42</td>
<td align="right">97.98</td>
<td align="right">98.35</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">ArrayList&lt;int&gt;</td>
<td align="left">Foreach</td>
<td align="right">63.03</td>
<td align="right">62.88</td>
<td align="right">63.24</td>
<td align="right">63.05</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">ArrayList&lt;int&gt;</td>
<td align="left">Foreach-Object</td>
<td align="right">374.20</td>
<td align="right">369.76</td>
<td align="right">376.02</td>
<td align="right">373.33</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">ArrayList&lt;int&gt;</td>
<td align="left">ScriptBlock</td>
<td align="right">86.63</td>
<td align="right">80.63</td>
<td align="right">80.79</td>
<td align="right">82.68</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">ArrayList&lt;int&gt;</td>
<td align="left">Filter</td>
<td align="right">75.81</td>
<td align="right">76.07</td>
<td align="right">76.78</td>
<td align="right">76.22</td>
</tr>
</tbody>
</table>
<p> </p>
<blockquote>Measured in miliseconds Collection length: 100000</blockquote>
<table border="0" width="819" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td align="left" width="107" height="21">Data Type</td>
<td align="left" width="141">Collection Type</td>
<td align="left" width="133">Loop Type</td>
<td align="left" width="107">Test 1</td>
<td align="left" width="107">Test 2</td>
<td align="left" width="117">Test 3</td>
<td align="left" width="107">Average</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">int[]</td>
<td align="left">For</td>
<td align="right">928.67</td>
<td align="right">989.31</td>
<td align="right">934.40</td>
<td align="right">950.79</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">int[]</td>
<td align="left">Foreach</td>
<td align="right">639.67</td>
<td align="right">655.97</td>
<td align="right">648.20</td>
<td align="right">647.95</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">int[]</td>
<td align="left">Foreach-Object</td>
<td align="right">3739.28</td>
<td align="right">3814.27</td>
<td align="right">3730.59</td>
<td align="right">3761.38</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">int[]</td>
<td align="left">ScriptBlock</td>
<td align="right">817.40</td>
<td align="right">820.79</td>
<td align="right">808.26</td>
<td align="right">815.49</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">int[]</td>
<td align="left">Filter</td>
<td align="right">818.23</td>
<td align="right">825.11</td>
<td align="right">838.87</td>
<td align="right">827.41</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">List&lt;int&gt;</td>
<td align="left">For</td>
<td align="right">1210.98</td>
<td align="right">1221.01</td>
<td align="right">1198.10</td>
<td align="right">1210.03</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">List&lt;int&gt;</td>
<td align="left">Foreach</td>
<td align="right">843.85</td>
<td align="right">843.32</td>
<td align="right">879.60</td>
<td align="right">855.59</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">List&lt;int&gt;</td>
<td align="left">Foreach-Object</td>
<td align="right">4280.31</td>
<td align="right">4326.06</td>
<td align="right">4254.13</td>
<td align="right">4286.83</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">List&lt;int&gt;</td>
<td align="left">ScriptBlock</td>
<td align="right">1075.82</td>
<td align="right">1105.29</td>
<td align="right">1072.61</td>
<td align="right">1084.57</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">List&lt;int&gt;</td>
<td align="left">Filter</td>
<td align="right">1060.23</td>
<td align="right">1081.08</td>
<td align="right">1071.59</td>
<td align="right">1070.97</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">ArrayList&lt;int&gt;</td>
<td align="left">For</td>
<td align="right">941.65</td>
<td align="right">937.21</td>
<td align="right">946.71</td>
<td align="right">941.86</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">ArrayList&lt;int&gt;</td>
<td align="left">Foreach</td>
<td align="right">622.43</td>
<td align="right">593.67</td>
<td align="right">589.76</td>
<td align="right">601.95</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">ArrayList&lt;int&gt;</td>
<td align="left">Foreach-Object</td>
<td align="right">3574.23</td>
<td align="right">3654.80</td>
<td align="right">3646.56</td>
<td align="right">3625.19</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">ArrayList&lt;int&gt;</td>
<td align="left">ScriptBlock</td>
<td align="right">765.73</td>
<td align="right">818.17</td>
<td align="right">776.87</td>
<td align="right">786.92</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">ArrayList&lt;int&gt;</td>
<td align="left">Filter</td>
<td align="right">759.23</td>
<td align="right">747.40</td>
<td align="right">743.89</td>
<td align="right">750.17</td>
</tr>
</tbody>
</table>
<p> </p>
<blockquote>Measured in miliseconds Collection length: 1000000</blockquote>
<table border="0" width="819" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td align="left" width="107" height="21">Data   Type</td>
<td align="left" width="141">Collection Type</td>
<td align="left" width="133">Loop Type</td>
<td align="left" width="107">Test 1</td>
<td align="left" width="107">Test 2</td>
<td align="left" width="117">Test 3</td>
<td align="left" width="107">Average</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">int[]</td>
<td align="left">For</td>
<td align="right">9744.00</td>
<td align="right">9438.96</td>
<td align="right">9758.17</td>
<td align="right">9647.04</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">int[]</td>
<td align="left">Foreach</td>
<td align="right">6766.58</td>
<td align="right">6401.43</td>
<td align="right">6640.43</td>
<td align="right">6602.81</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">int[]</td>
<td align="left">Foreach-Object</td>
<td align="right">38629.84</td>
<td align="right">37763.99</td>
<td align="right">38132.47</td>
<td align="right">38175.43</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">int[]</td>
<td align="left">ScriptBlock</td>
<td align="right">8480.02</td>
<td align="right">8277.16</td>
<td align="right">8329.73</td>
<td align="right">8362.30</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">int[]</td>
<td align="left">Filter</td>
<td align="right">8326.80</td>
<td align="right">8178.34</td>
<td align="right">8076.98</td>
<td align="right">8194.04</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">List&lt;int&gt;</td>
<td align="left">For</td>
<td align="right">12840.89</td>
<td align="right">12497.00</td>
<td align="right">12669.28</td>
<td align="right">12669.06</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">List&lt;int&gt;</td>
<td align="left">Foreach</td>
<td align="right">8913.08</td>
<td align="right">8733.64</td>
<td align="right">8840.35</td>
<td align="right">8829.02</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">List&lt;int&gt;</td>
<td align="left">Foreach-Object</td>
<td align="right">43677.32</td>
<td align="right">42700.12</td>
<td align="right">43606.07</td>
<td align="right">43327.84</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">List&lt;int&gt;</td>
<td align="left">ScriptBlock</td>
<td align="right">11180.41</td>
<td align="right">10921.40</td>
<td align="right">11042.95</td>
<td align="right">11048.25</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">List&lt;int&gt;</td>
<td align="left">Filter</td>
<td align="right">10552.67</td>
<td align="right">10176.99</td>
<td align="right">10198.66</td>
<td align="right">10309.44</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">ArrayList&lt;int&gt;</td>
<td align="left">For</td>
<td align="right">9361.94</td>
<td align="right">9696.00</td>
<td align="right">9582.81</td>
<td align="right">9546.92</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">ArrayList&lt;int&gt;</td>
<td align="left">Foreach</td>
<td align="right">6066.82</td>
<td align="right">6069.82</td>
<td align="right">6185.74</td>
<td align="right">6107.46</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">ArrayList&lt;int&gt;</td>
<td align="left">Foreach-Object</td>
<td align="right">36339.03</td>
<td align="right">36905.48</td>
<td align="right">37547.94</td>
<td align="right">36930.82</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">ArrayList&lt;int&gt;</td>
<td align="left">ScriptBlock</td>
<td align="right">7704.85</td>
<td align="right">7682.98</td>
<td align="right">7671.94</td>
<td align="right">7686.59</td>
</tr>
<tr>
<td align="left" height="21">int</td>
<td align="left">ArrayList&lt;int&gt;</td>
<td align="left">Filter</td>
<td align="right">7319.12</td>
<td align="right">7521.99</td>
<td align="right">7445.32</td>
<td align="right">7428.81</td>
</tr>
</tbody>
</table>
<p> </p>
<h2>Codes Used to Run the Test</h2>
<p>Mesure-Object was sat in each function to measure time. I know It should take out of function if you want to measure CAST cost. Declare Filter:</p>
<pre class="brush: powershell">filter Get-FilterTest{

        [decimal]$total += $_
}
</pre>
<p>Sample of For Loop Test:</p>
<pre class="brush: powershell">function Get-intForTest{

    param(
    $int
    )

    Measure-Command{
        for ($i = 0; $i -lt $int.length; $i++)
        {
            [decimal]$total += $int[$i]
        }
    }

}
</pre>
<p>Sample of Foreach Loop Test:</p>
<pre class="brush: powershell">function Get-intForeachTest{

    param(
    $int
    )

    Measure-Command{
        foreach ($i in $int)
        {
            [decimal]$total += $i
        }
    }

}
</pre>
<p>Sample of Foreach-Object Loop Test:</p>
<pre class="brush: powershell">function Get-intForeachObjectTest{

    param(
    $int
    )

    Measure-Command{
        $int | ForEach-Object{
            [decimal]$total += $_
        }
    }

}
</pre>
<p>Sample of ScriptBlock Loop Test:</p>
<pre class="brush: powershell">function Get-intScriptBlockTest{

    param(
    $int
    )

    Measure-Command{
        $int | &amp;{process{[decimal]$total += $_}}
    }

}
</pre>
<p>Sample of Filter Loop Test:</p>
<pre class="brush: powershell">function Get-intFilterTest{

    param(
    $int
    )

    Measure-Command{
        $int | Get-FilterTest
    }
}
</pre>
<p>Declare Collection.</p>
<pre class="brush: powershell">[int[]]$array=@()
$array += 1..30000000
</pre>
<p>Run code.</p>
<pre class="brush: powershell">(Get-intForTest -int $array).TotalMilliseconds
(Get-intForeachTest -int $array).TotalMilliseconds
(Get-intForeachObjectTest -int $array).TotalMilliseconds
(Get-intScriptBlockTest -int $array).TotalMilliseconds
(Get-intFilterTest -int $array).TotalMilliseconds
(Get-intFilterTest -int $array).TotalMilliseconds
</pre>
<p>Here's whole code, it run 4 time to measure.</p>
<pre class="brush: powershell">filter Get-FilterTest{

        [decimal]$total += $_
}

function Get-intForTest{

    param(
    $int
    )

    Measure-Command{
        for ($i = 0; $i -lt $int.length; $i++)
        {
            [decimal]$total += $int[$i]
        }
    }

}

function Get-intForeachTest{

    param(
    $int
    )

    Measure-Command{
        foreach ($i in $int)
        {
            [decimal]$total += $i
        }
    }

}

function Get-intForeachObjectTest{

    param(
    $int
    )

    Measure-Command{
        $int | ForEach-Object{
            [decimal]$total += $_
        }
    }

}

function Get-intScriptBlockTest{

    param(
    $int
    )

    Measure-Command{
        $int | &amp;{process{[decimal]$total += $_}}
    }

}

function Get-intFilterTest{

    param(
    $int
    )

    Measure-Command{
        $int | Get-FilterTest
    }
}

function Get-ListForTest{

	param(
	$int
	)

	$list  = New-Object 'System.Collections.Generic.List`1[System.String]'

	$int | foreach-Object { $list.Add($_)}

	#,$list

    Measure-Command{
	    for ($i = 0; $i -lt $int.length; $i++)
        {
    	    [decimal]$total += $list[$i]
        }
    }
}

function Get-ListForeachTest{

	param(
	$int
	)

	$list  = New-Object 'System.Collections.Generic.List`1[System.String]'

	$int | foreach-Object { $list.Add($_)}

	#,$list

    Measure-Command{
	    foreach ($l in $list)
        {
    	    [decimal]$total += $l
        }
    }
}

function Get-ListForeachObjectTest{

	param(
	$int
	)

	$list  = New-Object 'System.Collections.Generic.List`1[System.String]'

	$int | foreach-Object { $list.Add($_)}

	#,$list

    Measure-Command{
	    $list | foreach-Object{
    	    [decimal]$total += $_
        }
    }
}

function Get-ListScriptBlockTest{

	param(
	$int
	)

	$list  = New-Object 'System.Collections.Generic.List`1[System.String]'

	$int | foreach-Object { $list.Add($_)}

	#,$list

    Measure-Command{
	    $list | &amp;{process{[decimal]$total += $_}}
    }
}

function Get-ListFilterTest{
    param(
    $int
    )

	$list  = New-Object 'System.Collections.Generic.List`1[System.String]'

	$int | foreach-Object { $list.Add($_)}

	#,$list

    Measure-Command{
        $list | Get-FilterTest
    }
}

function Get-ArrayListForTest{
    param(
    $int
    )

	$arrayList = New-Object System.Collections.ArrayList

	[Void]($int | foreach-Object { $arrayList.Add($_) })

	#,$Arraylist

    Measure-Command{
	    for ($i = 0; $i -lt $int.length; $i++)
        {
    	    [decimal]$total += $arrayList[$i]
        }
    }
}

function Get-ArrayListForeachTest{
    param(
    $int
    )

	$arrayList = New-Object System.Collections.ArrayList

	[Void]($int | foreach-Object { $arrayList.Add($_) })

	#,$Arraylist

    Measure-Command{
	    foreach ($al in $arrayList)
        {
    	    [decimal]$total += $al
        }
    }
}

function Get-ArrayListForeachObjectTest{
    param(
    $int
    )

	$arrayList = New-Object System.Collections.ArrayList

	[Void]($int | foreach-Object { $arrayList.Add($_) })

	#,$Arraylist

    Measure-Command{
	    $arrayList | Foreach-Object{
    	    [decimal]$total += $_
        }
    }
}

function Get-ArrayListScriptBlockTest{
    param(
    $int
    )

	$arrayList = New-Object System.Collections.ArrayList

	[Void]($int | foreach-Object { $arrayList.Add($_) })

	#,$Arraylist

    Measure-Command{
	    $arrayList | &amp;{process{[decimal]$total += $_}}
    }
}

filter Get-ArrayListFilterTest{
    param(
    $int
    )

	$arrayList = New-Object System.Collections.ArrayList

	[Void]($int | foreach-Object { $arrayList.Add($_) })

	#,$Arraylist
	Measure-Command {
	    $arrayList | Get-FilterTest
    }
}

[int[]]$array=@()
$array += 1..30000000

1..4 | ForEach-Object {
(Get-intForTest -int $array).TotalMilliseconds
(Get-intForeachTest -int $array).TotalMilliseconds
(Get-intForeachObjectTest -int $array).TotalMilliseconds
(Get-intScriptBlockTest -int $array).TotalMilliseconds
(Get-intFilterTest -int $array).TotalMilliseconds

(Get-ListForTest -int $array).TotalMilliseconds
(Get-ListForeachTest -int $array).TotalMilliseconds
(Get-ListForeachObjectTest -int $array).TotalMilliseconds
(Get-ListScriptBlockTest -int $array).TotalMilliseconds
(Get-ListFilterTest -int $array).TotalMilliseconds

(Get-ArrayListForTest -int $array).TotalMilliseconds
(Get-ArrayListForeachTest -int $array).TotalMilliseconds
(Get-ArrayListForeachObjectTest -int $array).TotalMilliseconds
(Get-ArrayListScriptBlockTest -int $array).TotalMilliseconds
(Get-ArrayListFilterTest -int $array).TotalMilliseconds
""
}
</pre>
<h2>License</h2>
<p>This article, along with any associated source code and files, is licensed under <a href="http://www.codeproject.com/info/cpol10.aspx" target="_blank">The Code Project Open License (CPOL)</a></p>
