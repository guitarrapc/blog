---
Title: GitHub Actionsã®CVE-2025-30066ã‚’å—ã‘ãŸãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®å¤‰åŒ–
Category:
- CI/CD
Date: 2025-04-05T23:59:00+09:00
URL: https://tech.guitarrapc.com/entry/2025/04/05/235900
EditURL: https://blog.hatena.ne.jp/guitarrapc_tech/guitarrapc-tech.hatenablog.com/atom/entry/6802418398373396786
---

2025å¹´3æœˆ28æ—¥ã«ã‚ã£ãŸtj-actionã‚„reviewdogã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆ[CVE-2025-30066](https://nvd.nist.gov/vuln/detail/CVE-2025-30066)ã‚’å—ã‘ã¦ã€GitHub Actionsãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®æ›¸ãæ–¹ãŒå¤‰ãˆã¦ã—ã°ã‚‰ãçµŒã¡ã¾ã—ãŸã€‚ãã®å¯¾å¿œãƒ¡ãƒ¢ã‚’æ®‹ã—ã¾ã™ã€‚

[:contents]

# CVE-2025-30066ã®æ¦‚è¦

CVE-2025-30066ã®è©³ç´°ã¯[ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆ](https://unit42.paloaltonetworks.com/github-actions-supply-chain-attack/)ã«è©³ã—ã„ã§ã™ãŒã€ç°¡å˜ã«èª¬æ˜ã™ã‚‹ã¨[spotbugs/sonar-findbugs](https://github.com/spotbugs/sonar-findbugs)ã‚’èµ·ç‚¹ã«[reviewdog/action-setup](https://github.com/reviewdog/action-setup)ã‚’çµŒç”±ã—ã¦[tj-action/changed-files](https://github.com/tj-actions/changed-files)ã®ãƒªãƒªãƒ¼ã‚¹ã®ã»ã¨ã‚“ã©ãŒæ”¹ã–ã‚“ã•ã‚Œã¾ã—ãŸã€‚æ”¹ã–ã‚“ã‚³ãƒŸãƒƒãƒˆã¯ã€base64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸPythonã®ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒˆã‚³ãƒ¼ãƒ‰ã‚’å–å¾—/å®Ÿè¡Œã™ã‚‹ã‚‚ã®ã§ã€GitHub Actionsã®ãƒ©ãƒ³ãƒŠãƒ¼ã§å®Ÿè¡Œã•ã‚Œã‚‹ã¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’å–å¾—ã—ã¦BASE64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã—ã¦ãƒ­ã‚°å‡ºåŠ›ã—ã¾ã™ã€‚æ”»æ’ƒè€…ã®ç‹™ã„ã¯[coinbase/agentkit](https://github.com/coinbase/agentkit)ã ã£ãŸã‚ˆã†ã§ã™ãŒã€tj-action/changed-filesã®åˆ©ç”¨è€…ãŒå¤šãã€å½±éŸ¿ç¯„å›²ãŒåºƒãŒã‚Šã¾ã—ãŸã€‚

ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆã¯ã€tj-action/changed-filesã‚’ã‚¿ã‚°æŒ‡å®šã§åˆ©ç”¨ã—ã¦ã„ã‚‹GitHub Actionsãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã§ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆãŒActionãƒ­ã‚°ã«å‡ºåŠ›ã•ã‚Œã¾ã™ã€‚ãƒ‘ãƒ–ãƒªãƒƒã‚¯ãƒªãƒã‚¸ãƒˆãƒªã¯ãƒ“ãƒ«ãƒ‰ãƒ­ã‚°ã‚’ç¬¬ä¸‰è€…ãŒç¢ºèªã§ãã‚‹ãŸã‚ã€GitHub Actionsã®ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆãŒæ¼æ´©ã—ã¾ã™ã€‚ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒªãƒã‚¸ãƒˆãƒªã¯CIãƒ­ã‚°ã‚’å¤–éƒ¨ã‹ã‚‰ç¢ºèªã§ããªã„ãŸã‚å½±éŸ¿ã¯é™å®šçš„ã§ã™ã€‚

ãªãŠã€CVEç™ºç”Ÿæ™‚ã«GitHubã¯æ¬¡ã®å¯¾å¿œã‚’ã—ã¦ã„ã¾ã™ã€‚èˆˆå‘³æ·±ã‹ã£ãŸã®ã§ãƒ¡ãƒ¢ã—ã¦ãŠãã¾ã™ã€‚

* tj-action/changed-filesã®ãƒªãƒã‚¸ãƒˆãƒª/ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‰Šé™¤ã—ã¦ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ä½¿ç”¨ã§ããªã„ã‚ˆã†ã«å¤‰æ›´
* ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®ã™ã¹ã¦ã®ãƒªãƒªãƒ¼ã‚¹ãŒã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã€æ‚ªæ„ã‚ã‚‹ã‚³ãƒ¼ãƒ‰ãŒå«ã¾ã‚Œãªããªã£ã¦ã‹ã‚‰ãƒªãƒã‚¸ãƒˆãƒªã‚’å¾©æ—§
* æ‚ªæ„ã®ã‚ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼jurkaofavak/randolzfowã®å‰Šé™¤
* Gistã«å…¬é–‹ã•ã‚Œã¦ã„ãŸã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒˆã§åˆ©ç”¨ã•ã‚ŒãŸPythonã‚³ãƒ¼ãƒ‰ã®å‰Šé™¤[^1]
* å„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®GitHub PATã‚’æœŸé™åˆ‡ã‚Œã«è¨­å®š (å„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯PATã‚’ç™ºè¡Œã—ãªãŠã—ãŸã¯ãšã§ã™)

# CVE-2025-30066ã®å½±éŸ¿ã‚’è»½æ¸›ã™ã‚‹ã«ã¯ã©ã†ã™ã‚Œã°ã‚ˆã„ã®ã‹

CVE-2025-30066ã®ã‚ˆã†ãªGitHub Actionsã®ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆã¯ä»Šå¾Œã‚‚èµ·ã“ã‚‹å¯èƒ½æ€§ãŒé«˜ã„ã§ã™ã€‚GitHub Actionsã¯ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã§ã‚ã‚Šèª°ã§ã‚‚ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã§ãã¾ã™ã—ã€ãƒ¡ãƒ³ãƒ†ãƒŠã®PATãŒæ¼æ´©ã—ã¦æ„å›³ã›ãšå¤‰æ›´ã•ã‚Œã‚‹å¯èƒ½æ€§ã‚‚ã‚ã‚‹ã§ã—ã‚‡ã†ã€‚ç§ãŒåˆ©ç”¨è€…ã¨ã—ã¦æ”¹ã‚ã¦èªè­˜ã—ãŸãƒã‚¤ãƒ³ãƒˆã¯æ¬¡ã®é€šã‚Šã§ã™ã€‚

1. ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®ã‚¿ã‚°/ãƒªãƒªãƒ¼ã‚¹ã¯æ›¸ãæ›ãˆã‚‰ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹
3. åˆ©ç”¨è€…ã®Personal Access Token (PAT)ã‚„GITHUB Appã¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã§æ¼ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹
4. ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚„ã‚¸ãƒ§ãƒ–ã«è¨­å®šã—ãŸç’°å¢ƒå¤‰æ•°ã¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã«ã‚ˆã£ã¦CIãƒ­ã‚°ã«æ›¸ãå‡ºã›ã‚‹
5. ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚„ã‚¸ãƒ§ãƒ–ã®æ¨©é™ãŒé«˜ã„ã»ã©ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆãŒå¤§ãã„
6. ãƒ‘ãƒ–ãƒªãƒƒã‚¯ãƒªãƒã‚¸ãƒˆãƒªã®`pull_request_target`ã‚¤ãƒ™ãƒ³ãƒˆã®åˆ©ç”¨ã¯ãƒªã‚¹ã‚¯ãŒé«˜ã„
7. ã‚³ãƒŸãƒƒãƒˆã¯åˆ¥ãƒ¦ãƒ¼ã‚¶ãƒ¼ã§å½ã‚Œã‚‹
8. åˆ©ç”¨ã§ãã‚‹ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’é™å®šã™ã‚‹ã®ã¯ã‚ã‚‹ç¨‹åº¦æœ‰åŠ¹

å„æ‰€ã§è¨€ã‚ã‚ŒãŸã‚Šãƒ—ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ†ãƒ ã§å¾—ã‚‰ã‚Œã‚‹æ•™è¨“ã‚’ä¸¦ã¹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚ã“ã®ã†ã¡A, C, D, F, Gã¯é™çš„è§£æãƒ„ãƒ¼ãƒ«ã§è‡ªå‹•æ¤œçŸ¥ã§ãã‚‹ã®ã§å„ªå…ˆåº¦é«˜ã‚ã«å¯¾å¿œã—ã¾ã™ã€‚Bã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼/ã‚ªãƒ¼ã‚¬ãƒ‹ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³ã§ä¸€åº¦è¨­å®šã™ã‚Œã°OKãã†ã§ã™ã€‚E, H, I,Jã¯ãƒªãƒã‚¸ãƒˆãƒªã”ã¨ã«è¨­å®šãŒå¿…è¦ã§ã™ã€‚Hã¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’æ¡ç”¨ã™ã‚‹ã¨ãã®åˆ¤æ–­åŸºæº–ã§ã™ã€‚

* A: ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¯ã‚¿ã‚°/ãƒªãƒªãƒ¼ã‚¹ã§ã¯ãªãã‚³ãƒŸãƒƒãƒˆSHAã‚’æŒ‡å®šã™ã‚‹ (pinactã§å¯¾å¿œå¯èƒ½)
* B: ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã«æŒ‡å®šã™ã‚‹PATã‚„GITHUB Appã¯æ¨©é™ã‚’æœ€å°é™ã«ã™ã‚‹
* C: ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’ç’°å¢ƒå¤‰æ•°ã«è¨­å®šã™ã‚‹å ´åˆã€ã‚¹ãƒ†ãƒƒãƒ—ã®ç’°å¢ƒå¤‰æ•°ã«è¨­å®šã™ã‚‹ (ghalintã§æ¤œå‡ºå¯èƒ½)
* D: ã‚¸ãƒ§ãƒ–ã”ã¨ã«æœ€å°æ¨©é™ã‚’è¨­å®šã™ã‚‹ (ghalintã§æ¤œå‡ºå¯èƒ½)
* E: ãƒªãƒã‚¸ãƒˆãƒªã®è‡ªå‹•ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒˆãƒ¼ã‚¯ãƒ³ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ¨©é™ã‚’`write`ã‹ã‚‰`read`ã«è¨­å®š[^2]
* F: ãƒ‘ãƒ–ãƒªãƒƒã‚¯ãƒªãƒã‚¸ãƒˆãƒªã§`pull_request_target`ã‚¤ãƒ™ãƒ³ãƒˆã¯æ¥µåŠ›é¿ã‘ã‚‹ (ghalint/zizmorã§æ¤œå‡ºå¯èƒ½)
* G: ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®è¨˜æ³•ã‚’ãã‚ãˆã‚‹ (actionlintã§æ¤œå‡ºå¯èƒ½)
* H: Rulesetã§ã‚³ãƒŸãƒƒãƒˆç½²åã®å¿…é ˆåŒ–ã‚’æ¤œè¨ã™ã‚‹
* I: Rulesetã§ã‚¿ã‚°ã®æ›´æ–°ãƒ»å‰Šé™¤ã‚’ç¦æ­¢
* J: Rulesetã§ã‚¿ã‚°ã®ä½œæˆå¯èƒ½ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’organization adminã‚„repository adminã«é™å®šã™ã‚‹
* H: ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®åˆ©ç”¨å‰ã«å‡¦ç†å†…å®¹ã‚’æŠŠæ¡ã€ç®¡ç†ã™ã‚‹

é™çš„è§£æãƒ„ãƒ¼ãƒ«ã§è¨­å®šã‚’ç¢ºèª/èª¿æ•´ã€è‡ªå‹•åŒ–ã‚’æ¤œè¨ã€‚æ¬¡ã„ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼/ã‚ªãƒ¼ã‚¬ãƒ‹ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³ã®è¨­å®šè¦‹ç›´ã—ã€ãƒªãƒã‚¸ãƒˆãƒªã”ã¨ã®è¨­å®šã€ã¨ã„ã†é †ç•ªã§å¯¾å¿œã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚ã¾ãŸã€ç§ã¯tj-actionã¨reviewdogã¯ä½¿ã‚ãªã„ã“ã¨ã«ã—ã¾ã—ãŸã€‚

# é™çš„è§£æãƒ„ãƒ¼ãƒ«ã¨è‡ªå‹•åŒ–

çœŸã£å…ˆã«å–ã‚Šçµ„ã‚€ã¹ãã¯é™çš„è§£æãƒ„ãƒ¼ãƒ«ã«ã‚ˆã‚‹è‡ªå‹•åŒ–ã§ã™ã€‚ãƒªãƒã‚¸ãƒˆãƒªã‚’è¤‡æ•°ç®¡ç†ã—ã¦ã„ã‚‹ã¨æ‰‹å‹•ã§ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’èª¿æ•´ã™ã‚‹ã®ã¯ç„¡ç†ã§ã™ã€‚æ™‚é–“ã¯æœ‰é™ãªã®ã§ã€ã§ãã‚‹ã ã‘è‡ªå‹•åŒ–ã—ã¦è¦‹è½ã¨ã—ã‚’é˜²ãã¤ã¤ç²¾åº¦ã‚’é«˜ã‚ã¾ã—ã‚‡ã†ã€‚ãƒ„ãƒ¼ãƒ«ã«ã¯é™çš„è§£æãƒ„ãƒ¼ãƒ«ã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã‚’ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã«è‡ªå‹•é©ç”¨ã™ã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼ãƒ„ãƒ¼ãƒ«ãŒã‚ã‚Šã¾ã™ã€‚

ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®é™çš„è§£æã‚’ã™ã‚‹ãƒ„ãƒ¼ãƒ«ã¯æ¬¡ã®é€šã‚Šã§ã™ã€‚ã“ã‚Œã ã‘ã ã¨æŒ‡æ‘˜ãŒå¤šã™ãã¦ã‚„ã‚‹æ°—ãŒãªããªã‚‹ã®ã§ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã‚’ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã«è‡ªå‹•é©ç”¨ã™ã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼ãƒ„ãƒ¼ãƒ«ã‚’ä½µç”¨ã—ã¾ã™ã€‚

| ãƒ„ãƒ¼ãƒ«å | èª¬æ˜ |
| --- | --- |
| [actionlint](https://github.com/rhysd/actionlint) | ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®æ§‹æ–‡ãƒã‚§ãƒƒã‚¯ã¨Shellcheckãªã© |
| [ghalint](https://github.com/suzuki-shunsuke/ghalint) | ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®ç°¡æ˜“çš„ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ |
| [zizmor](https://github.com/woodruffw/zizmor) | ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®ã‚ˆã‚Šå³ã—ã„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ |

ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã‚’ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã«è‡ªå‹•é©ç”¨ã™ã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼ãƒ„ãƒ¼ãƒ«ã¯ã€é™çš„è§£æã§æŒ‡æ‘˜ã•ã‚Œã‚‹ã“ã¨ã‚’ä¿®æ­£ã—ã¦ãã‚Œã¾ã™ã€‚ã¾ãšã¯ã“ã‚Œã‚’å®Ÿè¡Œã—ã¦ã‹ã‚‰é™çš„è§£æã—ã¦ä¿®æ­£ã™ã‚‹ã‹ã©ã†ã‹æ±ºã‚ã‚‹ã¨ã„ã„ã§ã—ã‚‡ã†ã€‚

| ãƒ„ãƒ¼ãƒ«å | èª¬æ˜ |
| --- | --- |
| [pinact](https://github.com/suzuki-shunsuke/pinact) | ã‚¿ã‚°ã‚„ãƒ–ãƒ©ãƒ³ãƒæŒ‡å®šã•ã‚ŒãŸã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’SHAã«å¤‰æ›ã™ã‚‹ |
| [disable-checkout-persist-credentials](https://github.com/suzuki-shunsuke/disable-checkout-persist-credentials) | checkoutã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®`persist-credentials`ã‚’ç„¡åŠ¹åŒ–ã™ã‚‹ |

ç§ã¯æ¬¡ã®æµã‚Œã§è‡ªå‹•åŒ–ã‚’é€²ã‚ã¾ã—ãŸã€‚é †ã«è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

1. pinactã§SHAã«å¤‰æ›ã™ã‚‹
2. disable-checkout-persist-credentialsã§`checkout`ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®`persist-credentials`ã‚’ç„¡åŠ¹åŒ–ã™ã‚‹
3. Dependabotã§ã‚¢ã‚¯ã‚·ãƒ§ãƒ³æ›´æ–°ã‚’è‡ªå‹•åŒ–
4. actionlintã‚’å®Ÿè¡Œã—ã¦ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼æ§‹æ–‡ã‚’æ¨™æº–åŒ–ã™ã‚‹
5. ghalintã§ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œã—ã¦ã€å‡ºã¦ããŸã‚¨ãƒ©ãƒ¼/è­¦å‘Šã‚’ä¿®æ­£ã™ã‚‹
6. (Optional) zizmorã§ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œã—ã¦ã€å‡ºã¦ããŸã‚¨ãƒ©ãƒ¼/è­¦å‘Šã‚’ä¿®æ­£ã™ã‚‹

## ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’SHAã§å›ºå®šã™ã‚‹(pinact)

pinactã¯GitHub Actionsã®ã‚¿ã‚°ã‚„ãƒ–ãƒ©ãƒ³ãƒã‚’SHAã«ä¸€æ‹¬å¤‰æ›ã™ã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚SHAã«å¤‰æ›ã™ã‚‹ã“ã¨ã§ã€ä»Šå›ã®ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆã®ã‚ˆã†ã«ã‚¿ã‚°ã«æ‚ªæ„ã®ã‚ã‚‹ã‚³ãƒ¼ãƒ‰ãŒä»•è¾¼ã¾ã‚ŒãŸå ´åˆã§ã‚‚å½±éŸ¿ã‚’å—ã‘ã¾ã›ã‚“ã€‚[^3]

å¾Œè¿°ã™ã‚‹`ghalint`ã§SHAæŒ‡å®šã—ã¦ã„ãªã„ã®ã‚’æ¤œå‡ºã§ãã‚‹ã®ã§ã™ãŒã€`pinact`ã‚³ãƒãƒ³ãƒ‰ã‚’å©ãã ã‘ã§ä¿®æ­£ã§ãã¾ã™ã€‚

[f:id:guitarrapc_tech:20250430192822p:plain:alt=ghalintã®ã‚¨ãƒ©ãƒ¼ä¾‹]

```sh
$ pinact run
```

**å¬‰ã—ã„ãƒã‚¤ãƒ³ãƒˆ**

ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã ã‘ã§SHAã«å¤‰æ›ã•ã‚Œã‚‹ã®ã§ã€æ‰‹ä½œæ¥­ã‚ˆã‚Šåœ§å€’çš„ã«ç°¡å˜ã€ç¢ºå®Ÿã§ã™ã€‚SHAã«ã—ãŸã„ãªã‚‰`pinact`ã§99ï¼…è§£æ±ºã—ã¾ã™ã€‚ã‚³ãƒ³ãƒ•ã‚£ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã‚‚ã‚ã‚Šã¾ã™ãŒã€ãŠãŠã‚€ã­ä¸è¦ã§ã—ã‚‡ã†ã€‚

```yaml
# âŒ: tagæŒ‡å®š
- uses: actions/checkout@v4

# â­•: SHAæŒ‡å®š
- uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2
```

ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚‚ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆå¯¾è±¡ã«ã§ãã¾ã™ãŒã€ã“ã‚Œã¯ã†ã¾ãã„ã‹ãªã„ã‚±ãƒ¼ã‚¹ã‚‚ã‚ã‚‹ã‚ˆã†ãªã®ã§ã†ã¾ãã„ã£ãŸã‚‰ä¾¿åˆ©ç¨‹åº¦ã§ã„ã„ã§ã—ã‚‡ã†ã€‚

**ã¤ã‚‰ã„ãƒã‚¤ãƒ³ãƒˆ**

Organizationå†…éƒ¨ã§å¸¸ã«ãƒ–ãƒ©ãƒ³ãƒã‚’è¦‹ãŸã„ã‚±ãƒ¼ã‚¹ã§SHAã«å¤‰æ›ã•ã‚Œã‚‹ã®ã¯é‚ªé­”ã§ã™ã€‚å…ˆã»ã©ã®1ï¼…ã«è©²å½“ã™ã‚‹ã®ã§éƒ½åº¦å¯¾å‡¦ã§ã„ã„ã§ã™ã€‚ã‚³ãƒ³ãƒ•ã‚£ã‚°ã®`ignore_actions`ã«æŒ‡å®šã™ã‚‹ã¨SHAã«å¤‰æ›ã•ã‚Œãªã„ã‚ˆã†ã«ã§ãã¾ã™ã€‚

```yaml
# æ„å›³çš„ã«ãƒ–ãƒ©ãƒ³ãƒã‚’æŒ‡å®šã—ãŸã„ã‚±ãƒ¼ã‚¹ã§SHAã«å¤‰æ›ã•ã‚Œã‚‹ã¨é¢å€’
- uses: foo-organization/bar-action@main
```

## actions/checkoutã®persist-credentialsã‚’falseã«å¤‰æ›ã™ã‚‹(disable-checkout-persist-credentials)

GitHub Actionsã§ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆã™ã‚‹ã¨ãã¯`actions/checkout`ã‚’ä½¿ã†ã®ãŒå®šç•ªã§ã™ã€‚ãŸã ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§`persist-credentials: true`ã«ãªã£ã¦ãŠã‚Šã€æ‚ªæ„ã‚ã‚‹ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒãƒªãƒã‚¸ãƒˆãƒªã«ã‚³ãƒŸãƒƒãƒˆéšœå£ãŒ`permission`ã ã‘ã§ã™ã€‚æ˜ç¤ºçš„ã«`persist-credentials: false`ã‚’è¨­å®šã™ã‚‹ã“ã¨ã§ã€ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆå¾Œã®Gitèªè¨¼æƒ…å ±ã‚’ç„¡åŠ¹ã—ã¦Gitèªè¨¼æƒ…å ±ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚¹ãƒ†ãƒƒãƒ—ã‚’é™å®šã§ãã¾ã™ã€‚

å¾Œè¿°ã™ã‚‹`ghalint`ã‚„`zizmor`ã§falseã«ã—ã¦ã„ãªã„ã®ã‚’æ¤œå‡ºã§ãã‚‹ã®ã§ã™ãŒã€`disable-checkout-persist-credentials`ã‚³ãƒãƒ³ãƒ‰ã‚’å©ãã ã‘ã§ä¿®æ­£ã§ãã¾ã™ã€‚

[f:id:guitarrapc_tech:20250430192830p:plain:alt=ghalintã®ã‚¨ãƒ©ãƒ¼ä¾‹]

[f:id:guitarrapc_tech:20250430192838p:plain:alt=zizmorã®ã‚¨ãƒ©ãƒ¼ä¾‹]

```sh
$ disable-checkout-persist-credentials
```

**å¬‰ã—ã„ãƒã‚¤ãƒ³ãƒˆ**

ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã ã‘ã§`persist-credentials: false`ãŒè¨­å®šã•ã‚Œã‚‹ã®ã§ã€æ‰‹ä½œæ¥­ã‚ˆã‚Šåœ§å€’çš„ã«ç°¡å˜ã€ç¢ºå®Ÿã§ã™ã€‚

```yaml
# âŒ: persist-credentialsãŒtrueã ã¨ghalintã§ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹
- uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2
  with:
    persist-credentials: true

# âŒ: persist-credentialsãŒç„¡æŒ‡å®š(trueç›¸å½“)ã ã¨ghalintã¨zizmorã§ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹
- uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2

# â­•: persist-credentialsãŒfalseã‚’æŒ‡å®šã™ã‚‹
- uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2
  with:
    persist-credentials: false
```


**ã¤ã‚‰ã„ãƒã‚¤ãƒ³ãƒˆ**

`persist-credentials: false`ã«ã™ã‚‹ã¨ã€å¾Œç¶šã®ã‚¹ãƒ†ãƒƒãƒ—ã§ãƒ—ãƒƒã‚·ãƒ¥ã§ããªããªã‚Šã¾ã™ã€‚åœ°å‘³ã«ã‚ã‚“ã©ãã•ã„ã§ã™ãŒå®šå½¢ãƒ‘ã‚¿ãƒ¼ãƒ³ã§å¯¾å¿œã§ãã¾ã™ã€‚

```sh
fatal: could not read Username for 'https://github.com': No such device or address
Failed to push, try 'git pull --rebase' to resolve ...
```

GitHub Actionsã§ãƒ—ãƒƒã‚·ãƒ¥ã™ã‚‹ã«ã¯ã€`git remote set-url`ã§èªè¨¼ä»˜ããƒªãƒ¢ãƒ¼ãƒˆURLã‚’è¨­å®šã—ã¾ã™ã€‚ã‚³ãƒŸãƒƒãƒˆå‰ã«ãƒªãƒ¢ãƒ¼ãƒˆãƒªãƒã‚¸ãƒˆãƒªæƒ…å ±ã‚’ã‚»ãƒƒãƒˆã—ã¦ã‚ã’ã‚Œã°pushã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```yaml
# âŒ: git pushãŒã§ããªã„
- name: git push
  run: git push

# â­•: ã‚³ãƒŸãƒƒãƒˆå‰ã«ãƒªãƒ¢ãƒ¼ãƒˆãƒªãƒã‚¸ãƒˆãƒªæƒ…å ±ã‚’ã‚»ãƒƒãƒˆã™ã‚‹
- name: update current git to latest & Push changes
  shell: bash
  env:
    GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
  run: |
    git remote set-url origin "https://github-actions:${GITHUB_TOKEN}@githb.com/${{ github.repository }}"
    git config user.name  "github-actions[bot]"
    git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
- name: git push
  run: git push
```

## Actionsã®è‡ªå‹•æ›´æ–°ã‚’è¡Œã†(Dependabot)

ãƒªãƒã‚¸ãƒˆãƒªã«Dependabot[^4]ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«`.github/dependabot.yaml`ã‚’ç”¨æ„ã—ã¦ãŠãã¨Dependabotã«ã‚ˆã‚‹GitHub Actionsã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ›´æ–°ãŒè‡ªå‹•åŒ–ã§ãã¾ã™ã€‚å¹¸ã„ã«ã—ã¦SHAã§æŒ‡å®šã—ãŸå ´åˆã§ã‚‚Dependabotã¯SHAã‚’æ›´æ–°ã—ã¦ãã‚Œã¾ã™ã€‚

```yaml
# å…ƒãŒSHAæŒ‡å®šã§ã‚‚
- uses: actions/download-artifact@95815c38cf2ff2164869cbab79da8d1f422bc89e # v4.2.1

# Dependabotã¯æ›´æ–°ã—ã¦ãã‚Œã‚‹
- uses: actions/download-artifact@d3f86a106a0bac45b974a628896c90dbdf5c8093 # v4.3.0
```

**æ›´æ–°é »åº¦ã‚’èª¿æ•´ã™ã‚‹**

é »ç¹ã™ãã‚‹æ›´æ–°ã¯å¥½ã¾ã—ããªã„ã¨è€ƒãˆã¦ã„ã‚‹ã®ã§ã€é€±ä¸€æ›´æ–°ã‹ã¤ãƒ‘ãƒƒãƒãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯æ›´æ–°ã—ãªã„ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚æ™®æ®µä½¿ã£ã¦ã„ã‚‹è¨­å®šã¯æ¬¡ã®é€šã‚Šã§ã™ã€‚

```yaml
version: 2
updates:
  - package-ecosystem: "github-actions"
    directory: "/"
    schedule:
      interval: "weekly" # Check for updates to GitHub Actions every week
    ignore:
      # I just want update action when major/minor version is updated. patch updates are too noisy.
      - dependency-name: '*'
        update-types:
          - version-update:semver-patch

```

## ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®é™çš„è§£æã‚’è¡Œã†(actionlint)

ã“ã“ã‹ã‚‰ã¯é™çš„è§£æãƒ„ãƒ¼ãƒ«ã§ã™ã€‚

actionlintã¯GitHub Actionsã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼/ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®æ§‹æ–‡ãƒã‚§ãƒƒã‚¯ã‚’è¡Œã†ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚æ§‹æ–‡ãƒã‚§ãƒƒã‚¯ã ã‘ã§ãªãã€Shellcheckã‚„pyflakeãªã©ã‚‚å®Ÿè¡Œã—ã¦ãã‚Œã¾ã™ã€‚YAMLã®æ›¸ãæ–¹ãŒäººãã‚Œãã‚Œãªã®ã¯ã—ã‚‡ã†ãŒãªã„ã§ã™ãŒã€actionlintã‚’ä½¿ã†ã“ã¨ã§æ›¸ãæ–¹ã‚’ã‚ã‚‹ç¨‹åº¦æƒãˆã‚‰ã‚Œã¾ã™ã€‚

actionlintã‚’ä½¿ã†ã¨ã€æ¬¡ã®ã‚ˆã†ãªçŠ¶æ³ã‚’æ”¹å–„ã§ãã¾ã™ã€‚

- GitHub Actionsã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®å¦¥å½“æ€§æ¤œå‡º
- GitHub Actionsã®`${{ }}`æ§‹æ–‡ã®å¦¥å½“æ€§ã‚’æ¤œå‡º
- `runs-on`ã«æŒ‡å®šã•ã‚ŒãŸä¸æ˜ãªãƒ©ãƒ³ãƒŠãƒ¼ã‚’æ¤œå‡º
- `github`ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã§ãƒªã‚¹ã‚¯ãŒé«˜ã„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã‚’runsã«ç›´æ¥åŸ‹ã‚è¾¼ã‚“ã§ã„ã‚‹ã¨æ¤œå‡º
- Composite Actcionsã®ã‚·ã‚§ãƒ«ãŒãªã„ã¨æ¤œå‡º
- ä»–

å®Ÿè¡Œã‚‚ç°¡å˜ã§ã™ã€‚actionlintãŒä½•ã‹ã—ã‚‰æ¤œå‡ºã™ã‚‹ã¨çµ‚äº†ã‚³ãƒ¼ãƒ‰ãŒ1ã«ãªã‚‹ã®ã§ã€CI/CDã§ä½¿ã„ã‚„ã™ã„ã§ã™ã€‚å¾Œè¿°ã—ã¾ã™ãŒã€ç§ã¯CI/CDã§actionlintã‚’ç”¨ã„ã¦ã„ã¾ã™ã€‚

```sh
$ actionlint
```

[f:id:guitarrapc_tech:20250430192848p:plain:alt=actionlintã®æ¤œå‡ºä¾‹]

```yaml
# âŒ: runs-onãŒãªã„ã®ã§ã‚¨ãƒ©ãƒ¼
jobs:
  dump-context:
    timeout-minutes: 5
    steps:
      - run: echo foo

# â­•: runs-onã‚’æŒ‡å®šã™ã‚‹
jobs:
  dump-context:
    timeout-minutes: 5
    runs-on: ubuntu-24.04
    steps:
      - run: echo foo
```

[f:id:guitarrapc_tech:20250430192857p:plain:alt=actionlintã§runs-onãŒãªã„ã®ã‚’æ¤œå‡º]

**é™¤å¤–ãƒ«ãƒ¼ãƒ«**

ãªã‹ã«ã¯ãƒ«ãƒ¼ãƒ«ã‚’é™¤å¤–ã—ãŸã„å ´åˆã‚‚ã‚ã‚‹ã§ã—ã‚‡ã†ã€‚`.github/actionlint.yaml`ã«[é™¤å¤–ãƒ«ãƒ¼ãƒ«](https://github.com/rhysd/actionlint/blob/v1.7.7/docs/config.md)ã‚’æ›¸ãã“ã¨ã§æ¤œå‡ºã‹ã‚‰é™¤å¤–ã§ãã¾ã™ã€‚ç‰¹ã«é•·å¹´shellcheckã¯ã‚³ãƒ¡ãƒ³ãƒˆã§ã—ã‹é™¤å¤–ã§ããªã‹ã£ãŸã®ãŒæ”¹å–„ã—ã¦æœ€é«˜ã§ã™ã€‚

ä¾‹ãˆã°æ¬¡ã®stepã‚’ç”¨æ„ã—ã¾ã™ã€‚

```yaml
      - name: action
        run: echo $GITHUB_ACTION
        env:
          GITHUB_ACTION: ${{ github.action }}
```

actionlintã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€shellcheckã®SC2086ã«å¼•ã£ã‹ã‹ã‚Šã¾ã™ã€‚

```sh
$ actionlint
.github\workflows\context-github.yaml:53:9: shellcheck reported issue in this script: SC2086:info:1:6: Double quote to prevent globbing and word splitting [shellcheck]
   |
53 |         run: echo $GITHUB_ACTION
   |         ^~~~
```

SC2086ã¯æœ‰ç›Šãªã“ã¨ã‚‚å¤šã„ã®ã§ã™ãŒå¾®å¦™ãªã“ã¨ã‚‚å¤šã„ã®ã§ã€`.github/actionlint.yaml`ã«é™¤å¤–ãƒ«ãƒ¼ãƒ«ã‚’è¨­å®šã—ã¦ãŠãã¾ã™ã€‚

```yaml
paths:
  .github/workflows/**/*.{yml,yaml}:
    ignore:
      - 'shellcheck reported issue in this script: SC2086:.+'
```

**å¬‰ã—ã„ãƒã‚¤ãƒ³ãƒˆ**

actionlintã‚’ä½¿ã†æœ€å¤§ã®ãƒ¡ãƒªãƒƒãƒˆã¯ã€è¨˜æ³•ãŒä¸€å®šã«ãªã‚‹ã“ã¨ã§ã™ã€‚ä¾‹ãˆã°GitHub Actionsã®æ§‹æ–‡ã¯`if: å¼`ã¨`if: ${{ å¼ }}`ã®2ã¤ã®æ›¸ãæ–¹ãŒã‚ã‚Šã¾ã™ã€‚actionlintã‚’ä½¿ã†ã“ã¨ã§å¾Œè€…ã«çµ±ä¸€ã•ã‚Œã‚‹ã®ã§ã€VS Codeã®æ‹¡å¼µã§ã‚‚å¼ãŒã‚³ãƒ¼ãƒ‰ãƒã‚¤ãƒ©ã‚¤ãƒˆã•ã‚Œã‚‹ã®ã§ã‚ˆã„ã§ã™ã€‚ã“ã†ã„ã†è¨˜æ³•ã®çµ±ä¸€ã¯ã€GitHub Actionsã‚’ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã™ã‚‹ä¸Šã§åœ°å‘³ã«å¤§äº‹ã§ã™ã€‚

**ã¤ã‚‰ã„ãƒã‚¤ãƒ³ãƒˆ**

shellcheckã‚’é™¤å¤–ã™ã‚‹ã®ãŒæ­£ç›´é¢å€’ã§ã™ã€‚ä¾‹ãˆã°`$GITHUB_ENV`ã¨ã‹ã‚‚`"$GITHUB_ENV"`ã®ã‚ˆã†ã«ãƒ€ãƒ–ãƒ«ã‚¯ã‚©ãƒ¼ãƒˆã§æŒ‡å®šã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã®ã§ã€é™¤å¤–ãƒ«ãƒ¼ãƒ«ã«æ›¸ããŸããªã‚Šã¾ã™ã€‚

actionlintè‡ªä½“ã®è‰¯ã•ã¨ã€bashè‡ªä½“ã«ç–²å¼Šã™ã‚‹ãƒãƒ©ãƒ³ã‚¹ãŒé›£ã—ã„ã€‚ã¨ã„ã†ã‹ã€`shellcheck`ãŒå‰²ã¨ã‚„ã‚Šã™ãã¦ã„ã‚‹æ„Ÿã˜ãŒã‚ã£ã¦actionlintã®å°è±¡ãŒshellcheckã«å¼•ã£å¼µã‚‰ã‚Œã¦ã„ã‚‹æ°—ãŒã—ã¾ã™ã€‚

## ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ã‚’è¡Œã†(ghalint)

ghalintã¯GitHub Actionsã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼/ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®ç°¡æ˜“çš„ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ã‚’è¡Œã†ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚ä¸€ç•ªæ°—ã«ãªã‚‹ã¨ã“ã‚ã‚’ã‚«ãƒãƒ¼ã—ã¦ãã‚Œã€Goã§æ›¸ã‹ã‚Œã¦ã„ã¦å‹•ã‹ã—ã‚„ã™ã„ãŸã‚ã€ã¾ãšæ¤œè¨ã™ã‚‹ã®ãŒãŠã™ã™ã‚ã§ã™ã€‚é‡è‰¯ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã¯ã»ã¼ghalintã®æŒ‡æ‘˜ã‚’ã§ãã¦ã„ãªã„ã®ã§ã€ã©ã“ã‚’è¦‹ã‚‹ã¨ã„ã„ã‹ç›®ã‚’é¤Šãˆã¾ã™ã€‚

ghalintã¯æ¬¡ã®ã‚ˆã†ãªã“ã¨ã‚’æ¤œå‡ºã—ã¦ãã‚Œã¾ã™ã€‚

- permissionsã®æŒ‡å®šã‚’ã—ã¦ã„ãªã„ã¨æ¤œå‡º
- `read-all`ã‚„`write-all`ã®éå‰°ãªæ¨©é™ã‚’æ¤œå‡º
- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®æŒ‡å®šã‚’ãƒ•ãƒ«SHAã«ã—ã¦ã„ãªã„ã¨æ¤œå‡º
- `persist-credentials: false`ãŒãªã„actions/checkoutã‚’æ¤œå‡º
- `secrets: inherit`ã‚’æ¤œå‡º
- secretsã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãƒ¬ãƒ™ãƒ«ç’°å¢ƒåã™ã¸ã®è¨­å®šã‚’æ¤œå‡º
- secretsã®ã‚¸ãƒ§ãƒ–ãƒ¬ãƒ™ãƒ«ç’°å¢ƒå¤‰æ•°ã¸ã®è¨­å®šã‚’æ¤œå‡º
- ã‚³ãƒ³ãƒ†ãƒŠã‚¸ãƒ§ãƒ–ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã«latestã‚’æŒ‡å®šã—ã¦ã„ã‚‹ã¨æ¤œå‡º
- GitHub Appã‚’ãƒªãƒã‚¸ãƒˆãƒªé™å®šã—ã¦ã„ãªã„ã¨æ¤œå‡º
- ã‚¸ãƒ§ãƒ–ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆæŒ‡å®šãŒãªã„ã¨æ¤œå‡º
- ä»–

å®Ÿè¡Œã‚‚ç°¡å˜ã§ã™ã€‚ghalintãŒä½•ã‹ã—ã‚‰æ¤œå‡ºã™ã‚‹ã¨çµ‚äº†ã‚³ãƒ¼ãƒ‰ãŒ1ã«ãªã‚‹ã®ã§ã€CI/CDã§ä½¿ã„ã‚„ã™ã„ã§ã™ã€‚å¾Œè¿°ã—ã¾ã™ãŒã€ç§ã¯CI/CDã§ghalintã‚’ç”¨ã„ã¦ã„ã¾ã™ã€‚

```sh
# ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã¸ã®ghalintå®Ÿè¡Œ
$ ghalint run

# ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¸ã®ghalintå®Ÿè¡Œ
$ ghalint run-action
```

ä¾‹ãˆã°æ¬¡ã®ã‚ˆã†ãªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã¯ghalintã§æ¤œå‡ºã•ã‚Œã¾ã™ã€‚

```yaml
name: foo bar
on:
  push:
    branches: ["main"]

# âŒ: permissionsãŒã‚¸ãƒ§ãƒ–ãƒ¬ãƒ™ãƒ«ã«ãªã„ã®ã§ã‚¨ãƒ©ãƒ¼ (è¤‡æ•°ã‚¸ãƒ§ãƒ–ã®æ™‚ã ã‘æ¤œå‡º)
permissions:
  contents: read

# âŒ: secretsã‚’ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãƒ¬ãƒ™ãƒ«ã®ç’°å¢ƒå¤‰æ•°ã«æŒ‡å®šã—ã¦ã„ã‚‹ã®ã§ã‚¨ãƒ©ãƒ¼
env:
  BAR: ${{ secrets.BAR }}

jobs:
  action:
    # âŒ: secretsã‚’ã‚¸ãƒ§ãƒ–ãƒ¬ãƒ™ãƒ«ã®ç’°å¢ƒå¤‰æ•°ã«æŒ‡å®šã—ã¦ã„ã‚‹ã®ã§ã‚¨ãƒ©ãƒ¼
    env:
      FOO: ${{ secrets.FOO }}
    runs-on: ubuntu-24.04
    # âŒ: timeout-minutesãŒãªã„ã®ã§ã‚¨ãƒ©ãƒ¼
    steps:
      # âŒ: actions/checkoutãŒSHAæŒ‡å®šã•ã‚Œã¦ã„ãªã„ã®ã§ã‚¨ãƒ©ãƒ¼
      # âŒ: persist-credentials=falseãŒãªã„ã®ã§ã‚¨ãƒ©ãƒ¼
      - uses: actions/checkout@v4.2.2
      - run: echo "FOO=$FOO"

  action-2:
    runs-on: ubuntu-24.04
    timeout-minutes: 3
    steps:
      - run: echo "BAR=$BAR"
```

[f:id:guitarrapc_tech:20250503191436p:plain:alt=ghalintã®æ¤œå‡ºä¾‹]

ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ã‚¨ãƒ©ãƒ¼åŸå› ã‚„ä¿®æ­£æ–¹æ³•ãŒæ›¸ã‹ã‚Œã¦ã„ã‚‹ã®ã§å¾“ã„ã¾ã—ã‚‡ã†ã€‚

```yaml
name: foo bar
on:
  push:
    branches: ["main"]

jobs:
  action:
    # â­•: permissionsã‚’ã‚¸ãƒ§ãƒ–ãƒ¬ãƒ™ãƒ«ã«æŒ‡å®šã™ã‚‹
    permissions:
      contents: read
    runs-on: ubuntu-24.04
    # â­•: timeout-minutesã‚’æŒ‡å®šã™ã‚‹
    timeout-minutes: 3
    steps:
      # â­•: actions/checkoutã‚’SHAæŒ‡å®šã™ã‚‹
      # â­•: persist-credentials=falseã‚’æŒ‡å®šã™ã‚‹
      - uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2
        with:
          persist-credentials: false
      # â­•: secretsã‚’ã‚¹ãƒ†ãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ã®ç’°å¢ƒå¤‰æ•°ã«æŒ‡å®šã™ã‚‹
      - run: echo "FOO=$FOO"
        env:
          FOO: ${{ secrets.FOO }}

  action-2:
    # â­•: permissionsã‚’ã‚¸ãƒ§ãƒ–ãƒ¬ãƒ™ãƒ«ã«æŒ‡å®šã™ã‚‹
    permissions:
      contents: read
    runs-on: ubuntu-24.04
    timeout-minutes: 3
    steps:
      # â­•: secretsã‚’ã‚¹ãƒ†ãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ã®ç’°å¢ƒå¤‰æ•°ã«æŒ‡å®šã™ã‚‹
      - run: echo "BAR=$BAR"
        env:
          BAR: ${{ secrets.BAR }}
```

**é™¤å¤–ãƒ«ãƒ¼ãƒ«**

ãªã‹ã«ã¯ãƒ«ãƒ¼ãƒ«ã‚’é™¤å¤–ã—ãŸã„å ´åˆã‚‚ã‚ã‚‹ã§ã—ã‚‡ã†ã€‚`.ghalint.yaml`ã«é™¤å¤–ãƒ«ãƒ¼ãƒ«ã‚’æ›¸ãã“ã¨ã§ãƒ«ãƒ¼ãƒ«æ¤œå‡ºã‹ã‚‰é™¤å¤–ã§ãã¾ã™ã€‚æ¤œå‡ºã¯ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ãƒ­ã‚°ã‹ã‚‰ä½œã‚‹ã“ã¨ãŒã§ãã¦ä¾¿åˆ©ã§ã™ã€‚

ä¾‹ãˆã°æ¬¡ã®ã‚ˆã†ãªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ç”¨æ„ã—ã¾ã™ã€‚è‡ªåˆ†ã®ãƒªãƒã‚¸ãƒˆãƒªã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãªã®ã§ãƒ–ãƒ©ãƒ³ãƒæŒ‡å®šã‚’è¨±å¯ã—ãŸã„ã®ã§ã™ãŒã€SHAæŒ‡å®šã˜ã‚ƒãªã„ã®ã§å½“ç„¶ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã¾ã™ã€‚ã¾ãŸè‡ªãƒªãƒã‚¸ãƒˆãƒªã®Reusable Workflowã¯`secrets: inherit`ã‚’è¨±å¯ã—ãŸã„ã®ã§ã™ãŒã€`inherit`ã¯ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã¾ã™ã€‚

```yaml
jobs:
  call-workflow-passing-data:
    permissions:
      contents: read
    uses: guitarrapc/githubactions-lab/.github/workflows/_reusable-workflow-called.yaml@main # ghalintã§ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹

  call-workflow-passing-data2:
    permissions:
      contents: read
    uses: ./.github/workflows/_reusable-workflow-nest.yaml
    with:
      username: "foo"
      is-valid: true
    secrets: inherit # ghalintã§ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹

```

ghalintã‚’å®Ÿè¡Œã™ã‚‹ã¨æ¬¡ã®ã‚ˆã†ãªã‚¨ãƒ©ãƒ¼ãŒå‡ºã¾ã™ã€‚`action_ref_should_be_full_length_commit_sha`ãƒãƒªã‚·ãƒ¼ã«å¼•ã£ã‹ã‹ã£ã¦ã„ã‚‹ã®ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚

```sh
$ ghalint run
ERRO[0000] the job violates policies                     error="`secrets: inherit` should not be used. Only required secrets should be passed explicitly" job_name=call-workflow-passing-data2 policy_name=deny_inherit_secrets program=ghalint reference="https://github.com/suzuki-shunsuke/ghalint/blob/main/docs/policies/004.md" version=1.2.3 workflow_file_path=".github\\workflows\\reusable-workflow-public-caller.yaml"
ERRO[0000] the job violates policies                     action=guitarrapc/githubactions-lab/.github/workflows/_reusable-workflow-called.yaml error="action ref should be full length SHA1" job_name=call-workflow-passing-data policy_name=action_ref_should_be_full_length_commit_sha program=ghalint reference="https://github.com/suzuki-shunsuke/ghalint/blob/main/docs/policies/008.md" version=1.2.3 workflow_file_path=".github\\workflows\\reusable-workflow-public-caller.yaml"
```

è‡ªåˆ†ã®ãƒªãƒã‚¸ãƒˆãƒªã®actionã¯é™¤å¤–ã—ãŸã„ã®ã§ã€`.ghalint.yaml`ã«é™¤å¤–ãƒ«ãƒ¼ãƒ«ã‚’æ›¸ãã¾ã—ã‚‡ã†ã€‚`action_ref_should_be_full_length_commit_sha`ã¯`action_name`ã‚’æ±‚ã‚ã‚‹ã®ã«æ³¨æ„ã§ã™ã€‚ãƒ¯ã‚¤ãƒ«ãƒ‰ã‚«ãƒ¼ãƒ‰ã‚’æŒ‡å®šã§ãã‚‹ã®ã§`action_name`ã§ãƒ¯ã‚¤ãƒ«ãƒ‰ã‚«ãƒ¼ãƒ‰æŒ‡å®šã€`workflow_file_path`ã‚’çœç•¥ã™ã‚Œã°è‡ªåˆ†ã®ãƒªãƒã‚¸ãƒˆãƒªã®Reusable Workflowã‚’ã¾ã¨ã‚ã¦é™¤å¤–ã‚‚ã§ãã¾ã™ã€‚

```yaml
excludes:
  - policy_name: action_ref_should_be_full_length_commit_sha
    action_name: guitarrapc/githubactions-lab/.github/workflows/*
    workflow_file_path: .github/workflows/reusable-workflow-public-caller.yaml
  - policy_name: deny_inherit_secrets
    workflow_file_path: .github/workflows/reusable-workflow-public-caller.yaml
    job_name: call-workflow-passing-data2
```

**å¬‰ã—ã„ãƒã‚¤ãƒ³ãƒˆ**

ghalintã‚’ä½¿ã†ã“ã¨ã§ã€ã“ã‚Œã¯ã¾ãšã„ã®ã‹ã€ã¾ãšããªã„ã®ã‹ã€ã¨ã„ã†éƒ¨åˆ†ãŒå®šå½¢çš„ã«æ¤œå‡ºã•ã‚Œã¦ä¿®æ­£ã™ã‚‹æ–¹å‘ã«åŠ›ãŒåƒãã¾ã™ã€‚æŒ‡æ‘˜ã®ç¨‹åº¦ã‚‚ã‚ã¾ã‚Šã«å³ã—ã„ã‚‚ã®ã¯ãªã„ã®ã§ã€ä½¿ã„å‹æ‰‹ã®ãƒãƒ©ãƒ³ã‚¹ãŒã„ã„ã§ã™ã€‚

å†åˆ©ç”¨å¯èƒ½ãªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã§`secrets: inherit`ã‚’ã‚¨ãƒ©ãƒ¼ã«ã™ã‚‹ã®ã¯å‰²ã¨ã„ã„æŒ‡æ‘˜ã«æ„Ÿã˜ã¾ã™ã€‚ã¤ã„ã‚„ã£ã¡ã‚ƒã„ãŒã¡ã§ã™ãŒã€ãƒ‘ãƒ–ãƒªãƒƒã‚¯ãªãƒªãƒã‚¸ãƒˆãƒªã§ã¯secretsã‚’ã¡ã‚ƒã‚“ã¨æ˜ç¤ºã™ã‚‹ã»ã†ãŒã„ã„ã§ã—ã‚‡ã†ã€‚

```yaml
# âŒ: secretsã‚’inheritã«ã™ã‚‹ã¨ã‚¨ãƒ©ãƒ¼
jobs:
  call-workflow-passing-data:
    uses: ./.github/workflows/_reusable-workflow-called.yaml
    with:
      username: ${{ inputs.username }}
      is-valid: ${{ inputs.is-valid }}
    secrets: inherit

# â­•: secretsã‚’æ˜ç¤ºã™ã‚‹
jobs:
  call-workflow-passing-data:
    uses: ./.github/workflows/_reusable-workflow-called.yaml
    with:
      username: ${{ inputs.username }}
      is-valid: ${{ inputs.is-valid }}
    secrets:
      APPLES: ${{ secrets.APPLES }}
```

actions/checkoutã§`persist-credentials: false`ãŒæŒ‡å®šã•ã‚Œã¦ã„ãªã„ã¨ã‚¨ãƒ©ãƒ¼ã«ã™ã‚‹ã®ã‚‚ã„ã„æ„Ÿã˜ã§ã™ã€‚

```yaml
# âŒ: persist-credentialsãŒæœªæŒ‡å®šã‚„trueã ã¨ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹
- uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2

# â­•: persist-credentialsãŒfalseã ã¨ã‚¨ãƒ©ãƒ¼ã«ãªã‚‰ãªã„
- uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2
  with:
    persist-credentials: false
```

**ã¤ã‚‰ã„ãƒã‚¤ãƒ³ãƒˆ**

è¨˜æ³•ã«ä¾å­˜ã—ãŸæŒ‡æ‘˜ãŒã‚ã‚‹ã®ã¯å¾®å¦™ã§ã™ã€‚ä¾‹ãˆã°ã€ã‚¸ãƒ§ãƒ–ãŒ1ã¤ãªã‚‰ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãƒ¬ãƒ™ãƒ«ã®`permissions`ã‚’æŒ‡å®šã—ã¦ã‚‚å•é¡Œãªã„ã®ã§ã™ãŒã€ã‚¸ãƒ§ãƒ–ãŒè¤‡æ•°ã‚ã‚‹å ´åˆã¯ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãƒ¬ãƒ™ãƒ«ã®`permissions`ã‚’æŒ‡å®šã—ã¦ã‚‚ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã¾ã™ã€‚ã“ã‚Œã¯æ›¸ãæ–¹ã«ä¾å­˜ã™ã‚‹[^5]ã®ã§ã€ã‚¸ãƒ§ãƒ–ã«ä¸€æœ¬åŒ–ã—ãŸã»ã†ãŒã„ã„ã‚“ã˜ã‚ƒãªã„ã®ã‹ãªãã¨æ„Ÿã˜ã¾ã™ã€‚

ghalintã«ã€pinactã‚„disable-checkout-persist-credentialsã®ã‚ˆã†ãªè‡ªå‹•ä¿®æ­£æ©Ÿèƒ½ãŒã‚ã‚‹ã¨ã€ä»Šã©ãã®lintãƒ„ãƒ¼ãƒ«ã£ã½ã„æ°—ã‚‚ã—ã¾ã™ã€‚å…·ä½“çš„ã«ã¯`--fix`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã¤ã‘ã‚‹ã¨æ§‹æ–‡ã®è‡ªå‹•ä¿®æ­£ã—ã¦ãã‚Œã¦ã‚‚è‰¯ã•ãã†ã«æ„Ÿã˜ã¾ã™ã€‚

## ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®ã‚ˆã‚Šç´°ã‹ã„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ã‚’è¡Œã†(zizmor)

zizmorã¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ã‚’è¡Œã†ãƒ„ãƒ¼ãƒ«ã§ã€ghalintã‚ˆã‚Šã‚‚ãƒã‚§ãƒƒã‚¯ãŒå³ã—ç›®ã§ã™ã€‚ghalintã§æ¤œå‡ºã•ã‚Œãªã„ã‚‚ã®ã‚‚zizmorã§æ¤œå‡ºã•ã‚Œã‚‹ã®ã§ã€ghalintã§ä¿®æ­£ã—ãŸå¾Œã«zizmorã‚’å®Ÿè¡Œã™ã‚‹ã®ãŒã„ã„ã§ã—ã‚‡ã†ã€‚

Rustã§æ›¸ã‹ã‚Œã¦ã„ã‚‹ã®ã§ã™ãŒã€å„ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ å‘ã‘ã®ãƒã‚¤ãƒŠãƒªã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¯æ‰‹è–„ãªãŸã‚ã€DockerçµŒç”±ã§å®Ÿè¡Œã—ã¦ã„ã¾ã™ã€‚

```sh
# ãƒªãƒã‚¸ãƒˆãƒªã‚’/githubã«ãƒã‚¦ãƒ³ãƒˆã—ã¦mediumä»¥ä¸Šã®ã‚¨ãƒ©ãƒ¼ã‚’æ¤œå‡ºã™ã‚‹
docker run -t -v .:/github ghcr.io/woodruffw/zizmor:1.5.2 /github --min-severity medium
```

ä¾‹ãˆã°æ¬¡ã®ã‚ˆã†ãªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã¯zizmorã§æ¤œå‡ºã•ã‚Œã¾ã™ã€‚

```yaml
on:
  # âŒ: pull_request_targetã¯dangerous-triggersãªã®ã§zizmorã§ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹
  pull_request_target:
    branches: ["main"]

on:
# â­•: pull_requestã¯dangerous-triggersã˜ã‚ƒãªã„ã®ã§zizmorã§ã‚¨ãƒ©ãƒ¼ã«ãªã‚‰ãªã„
  pull_request:
    branches: ["main"]
```

**é™¤å¤–ãƒ«ãƒ¼ãƒ«**

zizmorã®é™¤å¤–ãƒ«ãƒ¼ãƒ«ã¯ã‚³ãƒ¡ãƒ³ãƒˆãƒ™ãƒ¼ã‚¹ã¨ã‚³ãƒ³ãƒ•ã‚£ã‚°ãŒã‚ã‚Šã¾ã™ã€‚[ã‚³ãƒ³ãƒ•ã‚£ã‚°](https://woodruffw.github.io/zizmor/configuration/)ã¯è¡ŒæŒ‡å®šãªã®ã§ä½¿ã„ã«ããã€ã‚³ãƒ¡ãƒ³ãƒˆãƒ™ãƒ¼ã‚¹ã®ã»ã†ãŒä½¿ã„ã‚„ã™ã„ã§ã™ã€‚

```yaml
      - run: echo "org:${{ matrix.org }} secret:${SECRET}"
        env:
          SECRET: ${{ secrets[matrix.secret] }} # zizmor: ignore[overprovisioned-secrets]
```

**å¬‰ã—ã„ãƒã‚¤ãƒ³ãƒˆ**

ghalintã‚ˆã‚Šã‚‚å³ã—ã„ãƒã‚§ãƒƒã‚¯ã‚’ã—ã¦ãã‚Œã‚‹ã®ã§ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£çš„ã«å®‰å¿ƒã§ã™ã€‚ãƒ«ãƒ¼ãƒ«ãŒ[ä¸€è¦§åŒ–](https://woodruffw.github.io/zizmor/audits/)ã•ã‚Œã¦ã„ã‚‹ã®ã§ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒåˆ†ã‹ã‚Šã‚„ã™ã„ã®ã‚‚ã„ã„ã§ã™ã­ã€‚

**ã¤ã‚‰ã„ãƒã‚¤ãƒ³ãƒˆ**

ghalintã¨é‡è¤‡ã—ã¦ã„ã‚‹é …ç›®ãŒå¤šãã€ghalintã§é™¤å¤–ã™ã‚‹å ´åˆzizmorã§ã‚‚é™¤å¤–ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ghalintã§ååˆ†ã§ã¯ã¨ã„ã†æ°—åˆ†ã«ãªã‚‹ã®ã¯å¦ã‚ã¾ã›ã‚“ã€‚

zizmorã‚’ä½¿ã£ã¦ã„ã¦ã€ä¿®æ­£ãŒã¡ã‚‡ã£ã¨å„ä»‹ã«æ„Ÿã˜ãŸã‚‚ã®ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚inputsã¯ä¸æ­£ãªæ–‡å­—åˆ—ã‚’å·®ã—è¾¼ã¾ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã®ã§ç’°å¢ƒå¤‰æ•°ã‚’ä½¿ãˆã¨ã„ã†æŒ‡æ‘˜ã§ã™ã€‚booleanãªã©inputsæ¬¡ç¬¬ã§å•é¡Œãªã„å¯èƒ½æ€§ãŒã‚ã‚‹ã«ã‚‚é–¢ã‚ã‚‰ãšinputsã«å¯¾ã—ã¦ä¸€å¾‹å³ã—ã„ã®ã¯ã‚ã‚“ã©ãã•ãæ„Ÿã˜ã¾ã—ãŸã€‚

```yaml
# âŒ: runã§inputsã‚’ç›´æ¥ä½¿ãŠã†ã¨ã™ã‚‹ã¨high levelã®ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹
- name: Output foo input
  shell: bash
  run: echo "foo is ${{ inputs.foo != '' && inputs.foo || env.FOO }}"

# â­•: ç’°å¢ƒå¤‰æ•°ã«ã„ã‚Œã¦ã‹ã‚‰ç’°å¢ƒå¤‰æ•°ã‚’runã§æŒ‡å®šã™ã‚‹ã€‚
- name: Output foo input
      shell: bash
      run: echo "foo is ${VALUE}"
      env:
        VALUE: ${{ inputs.foo != '' && inputs.foo || env.FOO }}
```

githubã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚‚ä¸æ­£ãªæ–‡å­—åˆ—ã‚’å·®ã—è¾¼ã¾ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã®ã§ç’°å¢ƒå¤‰æ•°ã‚’ä½¿ãˆã¨ã„ã†æŒ‡æ‘˜ã§ã™ã€‚ãƒ–ãƒ©ãƒ³ãƒåã‚„Issueã‚¿ã‚¤ãƒˆãƒ«ãªã©ã€ã‚³ãƒŸãƒƒã‚¿ãƒ¼ãŒè‡ªç”±ã«ã„ã˜ã‚Œã‚‹ã‚‚ã®ã¯ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ä½™åœ°ãŒã‚ã‚‹ã®ã§ã¾ãšã„ã®ã¯åŒæ„ã§ã™ãŒã€`event_name`ãªã©GitHubã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã™ã¹ã¦ã«ä¸€å¾‹å³ã—ã„ã®ã¯ã‚ã‚“ã©ãã•ãæ„Ÿã˜ã¾ã—ãŸã€‚

```yaml
# âŒ: event_nameã‚’ç›´æ¥ä½¿ãŠã†ã¨ã™ã‚‹ã¨high levelã®ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹
- name: file names
  id: file
  run: echo "name=${{ github.event_name }}${{ github.event.action != '' && format('_{0}', github.event.action) || ''}}${{ github.event_name == 'push' && format('_{0}', github.ref_type) || ''}}" | tee -a "$GITHUB_OUTPUT"

# â­•: ç’°å¢ƒå¤‰æ•°ã«ã„ã‚Œã¦ã‹ã‚‰ç’°å¢ƒå¤‰æ•°ã‚’runã§æŒ‡å®šã™ã‚‹ã€‚
- name: file names
  id: file
  env:
    EVENT_NAME: ${{ github.event_name }}
    EVENT_ACTION: ${{ github.event.action }}
    REF_TYPE: ${{ github.ref_type }}
  run: |
    ACTION_PART=""
    if [ -n "$EVENT_ACTION" ]; then
      ACTION_PART="_${EVENT_ACTION}"
    fi

    REF_PART=""
    if [ "$EVENT_NAME" = "push" ]; then
      REF_PART="_${REF_TYPE}"
    fi

    FILENAME="${EVENT_NAME}${ACTION_PART}${REF_PART}"
    echo "name=$FILENAME" | tee -a "$GITHUB_OUTPUT"
```

# GitHub Actionsè‡ªèº«ã§é™çš„è§£æã‚’è‡ªå‹•åŒ–ã™ã‚‹

é™çš„è§£æãƒ„ãƒ¼ãƒ«ã‚’GitHub Actionsã§è‡ªå‹•å®Ÿè¡Œã™ã‚‹ã¨ã€æ„å›³ã—ãªã„ãƒŸã‚¹ã‚’ç´ æ—©ãæ¤œå‡º/ä¿®æ­£ã§ãã¾ã™ã€‚ç§ã¯actionlint/ghalint/zizmorã‚’GitHub Actionsã§è‡ªå‹•å®Ÿè¡Œã—ã¦ã„ã¾ã™ã€‚

GitHub Actionsã§åŒãƒ„ãƒ¼ãƒ«ã‚’ä½¿ã†ã«ã‚ãŸã‚Šã€aquaã§ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’è¨­å®šã—ã¦ãŠãã¨ãƒ­ãƒ¼ã‚«ãƒ«ã¨CI/CDã§åŒã˜ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ç°¡å˜ã«åˆ©ç”¨ã§ãã‚‹ã®ã§ã‚ªã‚¹ã‚¹ãƒ¡ã—ã¾ã™ã€‚ä¾‹ãˆã°æ¬¡ã®ã‚ˆã†ãªaqua.yamlã‚’ãƒªãƒã‚¸ãƒˆãƒªãƒ«ãƒ¼ãƒˆã«è¨­å®šã—ã¦ãŠãã¾ã™ã€‚

```yaml
---
# aqua - Declarative CLI Version Manager
# https://aquaproj.github.io/
# checksum:
#   enabled: true
#   require_checksum: true
#   supported_envs:
#   - all
registries:
- type: standard
  ref: v4.332.0 # renovate: depName=aquaproj/aqua-registry
packages:
- name: rhysd/actionlint@v1.7.7
- name: suzuki-shunsuke/ghalint@v1.2.3

```

GitHub Actionsãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ç”¨æ„ã—ã¾ã™ã€‚zizmorã¯dockerã§å®Ÿè¡Œã—ã¦ã„ã¾ã™ã€‚

```yaml
name: actionlint
on:
  workflow_dispatch:
  pull_request:
    branches: ["main"]
    paths:
      - ".github/workflows/**"
  schedule:
    - cron: "0 0 * * *"

jobs:
  lint:
    permissions:
      contents: read
    runs-on: ubuntu-24.04
    timeout-minutes: 5
    steps:
      - uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2
        with:
          persist-credentials: false
      - uses: aquaproj/aqua-installer@e2d0136abcf70b7a2f6f505720640750557c4b33 # v3.1.1
        with:
          aqua_version: v2.43.1
      # github workflows/action's Static Checker
      - name: Run actionlint
        run: actionlint -color -oneline
      # checkout's persist-credentials: false checker
      - name: Run ghalint
        run: ghalint run
      # A static analysis tool for GitHub Actions
      - name: Run zizmor
        run: docker run -t -v .:/github ghcr.io/woodruffw/zizmor:1.5.2 /github --min-severity medium
```

# GitHubãƒ¦ãƒ¼ã‚¶ãƒ¼/ã‚ªãƒ¼ã‚¬ãƒ‹ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³ã®è¨­å®š

ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã«æŒ‡å®šã™ã‚‹PATã‚„GITHUB Appã¯æ¨©é™ã‚’æœ€å°é™ã«ã™ã‚‹ã—ã¦ã€ãƒˆãƒ¼ã‚¯ãƒ³æ¼æ´©æ™‚ã®å½±éŸ¿ã‚’é™å®šã—ã¾ã™ã€‚æ¼ã‚ŒãŸPATã§ä»–ã®ãƒªãƒã‚¸ãƒˆãƒªã«ã‚‚å½±éŸ¿ã—ãŸã®ãŒä»Šå›ã®CVEã®ã¾ãšã„ãƒã‚¤ãƒ³ãƒˆã®1ã¤ã§ã™ã€‚

* Legacy PATã‚’ã‚„ã‚ã¦Fine-grained PATã‚’æ¤œè¨ã—ã¾ã—ã‚‡ã†
* Fine-grained PATã¯ãƒªãƒã‚¸ãƒˆãƒªã‚„æ¨©é™ã‚’çµã‚Šã¾ã—ã‚‡ã†
* GITHUB Appã¯ãƒªãƒã‚¸ãƒˆãƒªã‚„æ¨©é™ã‚’ã‚’çµã‚Šã¾ã—ã‚‡ã†

# GitHubãƒªãƒã‚¸ãƒˆãƒªã”ã¨ã®è¨­å®š

ãƒªãƒã‚¸ãƒˆãƒªã®è‡ªå‹•ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒˆãƒ¼ã‚¯ãƒ³ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ¨©é™ã‚’writeã‹ã‚‰readã«è¨­å®šã—ã¦ã€ãƒˆãƒ¼ã‚¯ãƒ³æ¼æ´©æ™‚ã®å½±éŸ¿ã‚’é™å®šã—ã¾ã™ã€‚æ¼ã‚ŒãŸPATã§Writeæ¨©é™ãŒã‚ã‚Šã€ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã§ã‚‚é™å®šã§ãã¦ã„ãªã‹ã£ãŸã®ãŒä»Šå›ã®ã¾ãšã„ãƒã‚¤ãƒ³ãƒˆã®1ã¤ã§ã™ã€‚

* `ãƒªãƒã‚¸ãƒˆãƒª > Settings > Actions > General > Workflow permissions`ã§`Read`ã«å¤‰æ›´ã—ã¾ã—ã‚‡ã†[^6]

[f:id:guitarrapc_tech:20250505043317p:plain:alt=ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼æ¨©é™ã‚’Readæ¨©é™ã«é™å®šã™ã‚‹]

ãƒªãƒã‚¸ãƒˆãƒªã®ãƒ«ãƒ¼ãƒ«ã‚»ãƒƒãƒˆã§ã‚¿ã‚°ã®æ›´æ–°ã‚„å‰Šé™¤ã‚’ç¦æ­¢ã™ã‚‹ã“ã¨ã§ã€PATãŒæ¼ã‚Œã¦æ¨©é™ãŒã‚ã£ãŸã¨ã—ã¦ã‚‚ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®éå»ãƒªãƒªãƒ¼ã‚¹ä¸Šæ›¸ãã‚’é˜²ã’ã¾ã™ã€‚ãƒªãƒªãƒ¼ã‚¹ã§ãã‚‹äººã‚’é™å®šã§ãã‚‹ãªã‚‰ã€ãã‚Œã‚‚ã‚ã‚‹ç¨‹åº¦æœ‰åŠ¹ã§ã—ã‚‡ã†ãŒé‹å–¶ã«å½±éŸ¿ã™ã‚‹ã®ã§å¾®å¦™ãªãƒ©ã‚¤ãƒ³ã§ã™ã€‚ã‚‚ã—ã‚³ãƒŸãƒƒã‚¿ãƒ¼ãŒåˆ¶é™ã•ã‚Œã¦ã„ã¦ã€å…¨å“¡ãŒGPGç½²åã‚’ã—ã¦ã„ã‚‹ãªã‚‰ã€ã‚³ãƒŸãƒƒãƒˆç½²åã®å¿…é ˆåŒ–ã‚‚æœ‰åŠ¹ã§ã™ã€‚GitHub Actionsã®ã‚³ãƒŸãƒƒãƒˆã¯GPGç½²åã•ã‚Œãªã„ã®ã§ã€GPGç½²åã‚’å¿…é ˆã«ã—ã¦ãŠãã“ã¨ã§GitHub Actionsã§ã®ã‚³ãƒŸãƒƒãƒˆã‚’é˜²ã’ã¾ã™ã€‚

[f:id:guitarrapc_tech:20250505043326p:plain:alt=ãƒ«ãƒ¼ãƒ«ã‚»ãƒƒãƒˆã®è¨­å®šä¾‹]

# ã¾ã¨ã‚

ã„ã‚ã„ã‚ãªå¯¾å¿œãŒã‚ã‚Šã€ã©ã‚Œã‚’æ¡ç”¨ã™ã‚‹ã‹ã¯ãƒãƒ¼ãƒ ã®è€ƒãˆã«ä¾å­˜ã™ã‚‹ã§ã—ã‚‡ã†ã€‚ãŸã ã€å°‘ãªãã¨ã‚‚æ¨©é™ã‚’å°ã•ãã—ã¦ã€ã¾ãšã„è¨­å®šã«ãªã£ã¦ã„ãªã„ã‹è‡ªå‹•æ¤œå‡ºã ã‘ã¯ã—ã¾ã—ã‚‡ã†ã€‚ãã‚Œã ã‘ã§ã€ä»Šå›ã®ã‚±ãƒ¼ã‚¹ã¯é˜²ã’ã¾ã—ãŸã—ã€å½±éŸ¿ã‚’ä»–ã®ãƒªãƒã‚¸ãƒˆãƒªã«ä¼æ’­ã•ã›ã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚

ã‚µãƒ—ãƒ©ã‚¤ãƒã‚§ã‚¤ãƒ³æ”»æ’ƒã¨ã„ã£ã¦ã‚‚ã€ãƒªãƒã‚¸ãƒˆãƒªå˜ä½“ã§å½±éŸ¿ã‚’æŠ‘ãˆã‚Œã°å½±éŸ¿ã‚’æ³¢åŠã—ãªã„ã“ã¨ã‚’å†ç¢ºèªã—ãŸCVEã§ã—ãŸã€‚

# å‚è€ƒ

ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå ±å‘Š

* [NVD - CVE-2025-30066](https://nvd.nist.gov/vuln/detail/CVE-2025-30066)
* [GitHub Actions Supply Chain Attack: A Targeted Attack on Coinbase Expanded to the Widespread tj-actions/changed-files Incident: Threat Assessment (Updated 4/2)](https://unit42.paloaltonetworks.com/github-actions-supply-chain-attack/)
* [Semgrep | ğŸš¨ Popular GitHub Action tj-actions/changed-files is compromised](https://semgrep.dev/blog/2025/popular-github-action-tj-actionschanged-files-is-compromised/)
* [Harden-Runner detection: tj-actions/changed-files action is compromised - StepSecurity](https://www.stepsecurity.io/blog/harden-runner-detection-tj-actions-changed-files-action-is-compromised)
* [tj-actions ã®ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆãƒ¬ãƒãƒ¼ãƒˆã‚’èª­ã‚“ã ](https://zenn.dev/shunsuke_suzuki/articles/tj-actions-incident-2025#fork-network-%E3%81%AE%E6%82%AA%E7%94%A8)

ä»–ã®äººã®å¯¾å¿œä¾‹

* [GitHub ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ”¹å–„ | Zenn](https://zenn.dev/shunsuke_suzuki/articles/github-security-2025)
* [GitHub Actions ã‚’é™çš„æ¤œæŸ»ã™ã‚‹ãƒ„ãƒ¼ãƒ«ã®ç´¹ä»‹ (actionlint/ghalint/zizmor) | Zenn](https://zenn.dev/kou_pg_0131/articles/gha-static-checker)

ãƒ„ãƒ¼ãƒ«ä¸€è¦§

* [rhysd/actionlint: :octocat: Static checker for GitHub Actions workflow files | GitHub](https://github.com/rhysd/actionlint)
* [suzuki-shunsuke/ghalint: GitHub Actions linter | GitHub](https://github.com/suzuki-shunsuke/ghalint)
* [woodruffw/zizmor: Static analysis for GitHub Actions | GitHub](https://github.com/woodruffw/zizmor)
[suzuki-shunsuke/pinact: pinact is a CLI to edit GitHub Workflow and Composite action files and pin versions of Actions and Reusable Workflows. pinact can also update their versions and verify version annotations. | GitHub](https://github.com/suzuki-shunsuke/pinact)
* [suzuki-shunsuke/disable-checkout-persist-credentials: CLI to disable actions/checkout's persist-credentials | GitHub](https://github.com/suzuki-shunsuke/disable-checkout-persist-credentials)



[^1]: https://gist.githubusercontent.com/nikitastupin/30e525b776c409e03c2d6f328f254965/raw/memdump.py
[^2]: æ–°ã—ã„ãƒªãƒã‚¸ãƒˆãƒªã‚’ä½œã‚‹ã¨ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ`read`ã§ã™ãŒã€ä»¥å‰ã‹ã‚‰ã®ãƒªãƒã‚¸ãƒˆãƒªã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ`write`ã«ãªã£ã¦ã„ã¾ã™
[^3]: ã‚³ãƒŸãƒƒãƒˆã§åŒä¸€SHAã«è¡çªã•ã‚Œã‚‹ã‚±ãƒ¼ã‚¹ã§ã¯å•é¡Œã«ãªã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ãŒã€ãã‚Œã‚’è¨€ã„å‡ºã™ã¨Gitã¨ã„ã†ä»•çµ„ã¿è‡ªä½“ã‚’è€ƒãˆç›´ã™ã“ã¨ã«ãªã‚‹ã®ã§è€ƒæ…®å¤–ã¨ã—ã¾ã™
[^4]: ã‚‚ã—Renovateã‚’ä½¿ã£ã¦ã„ã‚‹ãªã‚‰ãã‚Œã§ã‚‚ã„ã„ã§ã™ã€‚
[^5]: ã‚¸ãƒ§ãƒ–ã‚’å¢—ã‚„ã—ãŸã‚‰ã‚¸ãƒ§ãƒ–ãƒ¬ãƒ™ãƒ«ã«æ›¸ãæ–¹ç›´ã™å¿…è¦ãŒå‡ºã¦ãã‚‹ã®ã§ã€æœ€åˆã‹ã‚‰ã‚¸ãƒ§ãƒ–ãƒ¬ãƒ™ãƒ«ã«æ›¸ã„ã¦ãŠãã®ãŒã„ã„ã§ã—ã‚‡ã†
[^6]: æ–°ã—ã„ãƒªãƒã‚¸ãƒˆãƒªã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ`Read`ã§ã™ãŒã€ä»¥å‰ã‹ã‚‰ã®ãƒªãƒã‚¸ãƒˆãƒªã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ`Write`ã«ãªã£ã¦ã„ã¾ã™
