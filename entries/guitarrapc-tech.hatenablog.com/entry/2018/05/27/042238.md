---
Title: 「PowerShell実践ガイドブック」の見どころと書いていないこと
Category:
- PowerShell
- Publish
Date: 2018-05-27T04:22:38+09:00
URL: https://tech.guitarrapc.com/entry/2018/05/27/042238
EditURL: https://blog.hatena.ne.jp/guitarrapc_tech/guitarrapc-tech.hatenablog.com/atom/entry/17391345971648284313
Draft: true
---

5/30に発売されるPowerShell実践ガイドブック、こと #貝殻本ですが発売まであと3日となりました。

> http://tech.guitarrapc.com/entry/2018/05/08/144132

発売前にも関わらずAmazonのいくつかのランキングで上位になり、今も予約をいただいているようで本当にありがとうございます。

[f:id:guitarrapc_tech:20180527031831p:plain]

[asin:4839965986:detail]

今回は、購入にあたって参考になるように、見どころと書いていないことについて紹介したいと思います。レビューをしていただいた[@stknohg](https://twitter.com/stknohg)さんも、書評の中でいくつか触れていらっしゃるのでぜひ参考にしてみてください。

> http://blog.shibata.tech/entry/2018/05/25/212621

<!-- more -->

[:contents]

## 見どころ

本書は624ページと、かなりボリュームが大きくなっています。なるべく冗長な表現は避けましたが、「章ごとに想定読者を設けている」ことから1章、2章は経験者の方にとっては冗長かと思います。

### 章ごとの想定読者

1章 :
2章 :
3章 :
4章 :
5章 :




## 書いていないこと

いくつか書いていないことがあります。これらに関してご期待されている場合、心苦しいのですが本書で得ることはできません。

### 機能

### Desired State Configurationの運用とリソース、コンフィグレーションとベストプラクティス

本書ではDSCの実践的な利用に関しては触れていません。つまり、リソース作成、PULL/PUSHサーバー展開のベストプラクティス、Azure Automation DSCでの展開などを期待されている場合、本書では得ることができません。

私自身がPowerShell Desired State ConfigurationのWeb寄稿をしていることからDSCについて期待をされるかもしれません。私自身も書きたかく締め切りぎりぎりまで悩んだのですが、PowerShell Core以降のDSCが非常に流動的な状況かつ、今後どのDSC機能が実践で活用されるか予想が困難だったため、あえて書面で詳しく触れることを断念しました。

代わりにDSCがPowerShell Coreでどのように変わるのかに関して、現時点での予想を紹介しています。

### Active Directoryなどの個別モジュールの使い方

本書では、PowerShell 5.1で書いていたモジュールの使い方や、Windows PowerShellでしか動かないモジュールの動作方法にも触れていますが、具体的なActive Directoryモジュールといった個別のモジュールの使い方には触れていません。

PowerShell 5.1まで動いていても、PowerShell 6.0 (.NET Core) で動かないモジュールはあります。Active Directoryモジュールなどの、Windowsプラットフォーム、.NET Frameworkに依存したものは顕著な例です。

> https://github.com/PowerShell/PowerShell/issues/6083

ではPowerShell 6.0でどのような要領で扱うといいのか、といったことを書いてあります。

#### Just Enough Administration (JEA)

JEAはWindowsプラットフォーム依存機能を多く使っているため、PowerShell 6.0では使えません。そのため、本書では触れていません。PowerShell 5.1では使えるものの、日本語のJEAの紹介はかなり乏しいのは残念ですが、本書も見送りました。

> http://www.atmarkit.co.jp/ait/articles/1607/28/news027.html

ちなみにJEAはPowerShell 5.0で導入された機能で、「必要な時に必要な権限だけを与える」というコンセプトを持つ**システム管理を適切にアクセス制御するための機能**です。システム管理者にとって非常に煩雑で現実的に断念することが多いケースとして、「Active Directory参加ユーザーが、何かをしたいといわれたときにドメイン権限で不許可にしている。しかし、ユーザー自身に本当はやれるようにしたい。だけれどもきめ細かい認可、制御は現実的に難しい労力が必要で諦めている」というケースを考えてみましょう。
JEAを使うと、管理者があらかじめJEAで許可した内容は、「ユーザー自身が必要としたタイミングだけ」「一時的に」「必要な権限にユーザー権限を拡張して」「操作を許可する」ことができます。管理者にとっても、いちいちユーザーやユーザーPCに設定する必要がなくなります。
システム管理者とユーザー、お互いがWin-Winになるための「適切なアクセス制御」をもたらすキーファクター、それがJEAです。

### 実践的だが細かな差異や注意

#### 罠、トラップといわれるような細かな挙動

本書では、他言語、あるいは普段の操作からほぼ間違いなく混乱を有無であろう挙動については重点的に触れました。その典型れは配列であり、スコープでありスクリプトブロックやクロージャです。

一方で、実践的といってパッと思いつくような「個別のコマンドレットごとの注意したほうが挙動」については触れていません。あくまでも、PowerShell自身の扱い方で気を付けるべきことに注力して説明に徹したためです。例えば、Group-Objectの-AsHashTableパラメータ時の挙動とか、そういった細かい注意は書いていないということです。

そういったものは、すでにコミュニティで情報を集めており知られつつあるので参考にしてみてください。

> https://github.com/nightroman/PowerShellTraps

#### Pro PowerShell Tips といわれるような小ネタ

Twitterで`#PowerShell #ProTip`で検索すると、小ネタやPowerShellで罠っぽい挙動に遭遇する例が数多くツイートされています。

> https://Twitter.com/search?f=tweets&vertical=default&q=%23powerShell%20%23Protip&src=typd

実際にPowerShellを触っていると、一度会ったことがあるような内容も多く読んでいて楽しいのですが、本書ではこういった小ネタを中心とした紹介は避けています。もちろんサンプルでさりげなく紹介したり使っているものも多くあります。それは実際にProTipsといわれると気付くければと、意外と使っている内容が多いということでもあります。

例えば、パイプライン越しの値を、コマンドレットのパラメータに渡す時にスクリプトブロックで値をいじれる例は1章で普通に書いています。

[Joel Bennett (@Jaykul) May 25, 2018](https://twitter.com/Jaykul/status/999852304777011200?ref_src=twsrc%5Etfw)

また、連想配列でValuesという名前をキーにするのは避けたほうがいいということは、連想配列のキーを配列として取得するための予約プロパティ`Keys`、値を配列として取得するための予約プロパティ`Values`の前提知識を紹介しています。前提があれば、名前に使わない方がいいということは分かると考えています。

[Joel Bennett (@Jaykul) May 15, 2018](https://twitter.com/Jaykul/status/996487239235522560?ref_src=twsrc%5Etfw)

こういった、ProTipといわれる小ネタは、自身が余り操作しない処理やPowerShell独自の挙動であるために「自身の経験が余り生きない」けど「困ったことがある」ものが多いように思います。一方で本書は体系的にこれらの知識に触れているので「纏まっていると面白いだろうが、冗長的な説明になる」と判断したため外しました。

### PowerShell 6.0 のモジュールにおけるベストプラクティス

PowerShell 5.1と微妙に変わったのが、PowerShell 6.0向けのC#など.NETプログラミング言語によるバイナリモジュール作成でしょう。最新の適切に扱うためのベストプラクティス情報で書いているため、すぐにでも使えるように意図しているものの、LibGit2Sharpのネイティブdllを含んだPowerShell 6.0モジュールがインポートモジュール時にコケるなどのケースを網羅するようには書いていません。
