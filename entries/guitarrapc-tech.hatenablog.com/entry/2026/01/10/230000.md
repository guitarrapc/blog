---
Title: AWS Lambdaã®.NET10å¯¾å¿œã¨C#ã®ãƒ•ã‚¡ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ã‚µãƒãƒ¼ãƒˆ
Category:
- C#
- AWS
Date: 2026-01-10T23:00:00+09:00
URL: https://tech.guitarrapc.com/entry/2026/01/10/230000
EditURL: https://blog.hatena.ne.jp/guitarrapc_tech/guitarrapc-tech.hatenablog.com/atom/entry/17179246901343833084
---

2025å¹´11æœˆã«.NET 10ãŒãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã¾ã—ãŸãŒã€2026å¹´1æœˆ6æ—¥ã«AWS LambdaãŒ.NET 10ã‚’[ã‚µãƒãƒ¼ãƒˆ](https://aws.amazon.com/jp/about-aws/whats-new/2026/01/aws-lambda-dot-net-10/)ã—ã¾ã—ãŸã€‚
ã“ã‚Œã«ä¼´ã„ãƒ•ã‚¡ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®C# Lambdaé–¢æ•°ã‚‚ã‚µãƒãƒ¼ãƒˆã•ã‚Œã€`.cs`ãƒ•ã‚¡ã‚¤ãƒ«ã ã‘ç”¨æ„ã™ã‚Œã°Lambdaé–¢æ•°ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

AWS Lambdaã§C#ã‚’æ›¸ãä½“é¨“ãŒå¤‰ã‚ã£ãŸã®ã§ã€ä»Šå›ã¯ãã®é­…åŠ›ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

> ãƒ•ã‚¡ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®C# Lambdaé–¢æ•°ã«ã¤ã„ã¦ã€[ä»¥å‰æ›¸ã„ãŸè¨˜äº‹](https://tech.guitarrapc.com/entry/2025/04/11/235900)ã‚‚å‚è€ƒã«ã—ã¦ãã ã•ã„ã€‚

[:contents]

## ã¯ã˜ã‚ã«

ãƒ•ã‚¡ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®C# Lambdaé–¢æ•°ã¯ã€`.cs`ãƒ•ã‚¡ã‚¤ãƒ«ã ã‘ã§Lambdaé–¢æ•°ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã§ãã¾ã™ã€‚

ã“ã‚Œã¾ã§ã¯.csproj + `.cs`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”¨æ„ â†’ nugetãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’è¿½åŠ  â†’ ãƒ“ãƒ«ãƒ‰ â†’ zipåŒ– â†’ ãƒ‡ãƒ—ãƒ­ã‚¤...ã¨ã„ã£ãŸæ‰‹é †ãŒå¿…è¦ã§ã—ãŸãŒã€ç°¡å˜ã«ãªã‚Šã¾ã—ãŸã€‚
IaCã§ã¯å¼•ãç¶šããƒ“ãƒ«ãƒ‰ãŒå¿…è¦ã§ã™ãŒã€dotnet toolã§ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹åˆ†ã«ã¯ãƒ“ãƒ«ãƒ‰ã‚¹ãƒ†ãƒƒãƒ—ã‚‚ä¸è¦ã§ã€ä½“é¨“çš„ã«ã¯Pythonã‚„Node.jsã®ã‚ˆã†ã«ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãã®ã¾ã¾ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã®ã«è¿‘ã„æ„Ÿè¦šã§ã™ã€‚

- dotnet toolã§ãƒ‡ãƒ—ãƒ­ã‚¤: `.cs`ãƒ•ã‚¡ã‚¤ãƒ«ã ã‘ç”¨æ„ã—ãŸã‚‰ãƒ‡ãƒ—ãƒ­ã‚¤ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œ
- IaCã§ãƒ‡ãƒ—ãƒ­ã‚¤: `.cs`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã€ãƒã‚¤ãƒŠãƒªã‚’æŒ‡å®šã—ã¦ãƒ‡ãƒ—ãƒ­ã‚¤

æ¬¡ã®ã‚³ãƒ¼ãƒ‰ã¯ã‚³ãƒ¡ãƒ³ãƒˆã‚’æŠœã„ãŸãƒŸãƒ‹ãƒãƒ ãªã‚µãƒ³ãƒ—ãƒ«C#ã‚³ãƒ¼ãƒ‰ã§ã€å…¥åŠ›ã•ã‚ŒãŸæ–‡å­—åˆ—ã‚’å¤§æ–‡å­—ã«å¤‰æ›ã—ã¦è¿”ã™ã ã‘ã®é–¢æ•°ã§ã™ã€‚

```cs
#:package Amazon.Lambda.Core@2.8.0
#:package Amazon.Lambda.RuntimeSupport@1.14.1
#:package Amazon.Lambda.Serialization.SystemTextJson@2.4.4
#:property TargetFramework=net10.0

using Amazon.Lambda.Core;
using Amazon.Lambda.RuntimeSupport;
using Amazon.Lambda.Serialization.SystemTextJson;
using System.Text.Json.Serialization;

// The function handler
var handler = (string input, ILambdaContext context) =>
{
    return input.ToUpper();
};

await LambdaBootstrapBuilder.Create(handler, new SourceGeneratorLambdaJsonSerializer<LambdaSerializerContext>())
  .Build()
  .RunAsync();

[JsonSerializable(typeof(string))]
public partial class LambdaSerializerContext : JsonSerializerContext
{
}
```

ã“ã‚Œã‚’`ToUpper.cs`ã¨ã„ã†åå‰ã§ä¿å­˜ã—ã€`dotnet lambda deploy-function`ã‚³ãƒãƒ³ãƒ‰ã§ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã ã‘ã§ã€Lambdaé–¢æ•°ãŒä½œæˆã•ã‚Œã¾ã™ã€‚

## File-based C# Lambdaé–¢æ•°ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹

ã‚‚ã†å°‘ã—è©³ã—ãè¦‹ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

C#ã‚³ãƒ¼ãƒ‰ã¯[Amazon.Lambda.Templates](https://www.nuget.org/packages/Amazon.Lambda.Templates)ã§è¿½åŠ ã§ãã‚‹`lambda.FileBased`ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ãƒ™ãƒ¼ã‚¹ã«é–‹å§‹ã§ãã¾ã™ã—ã€ãã‚“ãªã®ã‚’å…¥ã‚Œãªãã¦ã‚‚ã‚³ãƒ”ãƒ¼&ãƒšãƒ¼ã‚¹ãƒˆã§ã‚‚å¤§ä¸ˆå¤«[^1]ã§ã™ã€‚

ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½¿ã†å ´åˆã¯ã€æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚

```shell
dotnet new lambda.FileBased -n ToUpper
```

ã‚ã‚‹ã„ã¯ã€ç©ºã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—ã¦ã€`.cs`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚ä»Šå›ã¯`ToUpper.cs`ã¨ã„ã†åå‰ã«ã—ã¾ã™ã€‚

```
$ tree
.
â””â”€â”€ ToUpper.cs
```

### C#ã‚³ãƒ¼ãƒ‰ã‚’ç”¨æ„ã™ã‚‹

ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‹ã‚‰ç”Ÿæˆã•ã‚Œã‚‹`ToUpper.cs`ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸­èº«ã¯å…ˆã®ã‚³ãƒ¼ãƒ‰ã¨ã»ã¼åŒã˜ã§ã™ã€‚
ã‚³ãƒ¼ãƒ‰å…¨ä½“ã‚’æ”¹ã‚ã¦ç¤ºã—ã¾ã™ã€‚

```cs
// C# file-based Lambda functions can be deployed to Lambda using the
// .NET Tool Amazon.Lambda.Tools version 6.0.0 or later.
//
// Command to install Amazon.Lambda.Tools
//   dotnet tool install -g Amazon.Lambda.Tools
//
// Command to deploy function
//    dotnet lambda deploy-function <lambda-function-name> MyLambdaFunction.cs
//
// Command to package function
//    dotnet lambda package MyLambdaFunction.zip MyLambdaFunction.cs


#:package Amazon.Lambda.Core@2.8.0
#:package Amazon.Lambda.RuntimeSupport@1.14.1
#:package Amazon.Lambda.Serialization.SystemTextJson@2.4.4

// Explicitly setting TargetFramework here is done to avoid
// having to specify it when packaging the function with Amazon.Lambda.Tools
#:property TargetFramework=net10.0

// By default File-based C# apps publish as Native AOT. When packaging Lambda function
// unless the host machine is Amazon Linux a container build will be required.
// Amazon.Lambda.Tools will automatically initate a container build if docker is installed.
// Native AOT also requires the code and dependencies be Native AOT compatible.
//
// To disable Native AOT uncomment the following line to add the .NET build directive
// that disables Native AOT.
//#:property PublishAot=false

using Amazon.Lambda.Core;
using Amazon.Lambda.RuntimeSupport;
using Amazon.Lambda.Serialization.SystemTextJson;
using System.Text.Json.Serialization;

// The function handler that will be called for each Lambda event
var handler = (string input, ILambdaContext context) =>
{
    return input.ToUpper();
};

// Build the Lambda runtime client passing in the handler to call for each
// event and the JSON serializer to use for translating Lambda JSON documents
// to .NET types.
await LambdaBootstrapBuilder.Create(handler, new SourceGeneratorLambdaJsonSerializer<LambdaSerializerContext>())
  .Build()
  .RunAsync();

// Since Native AOT is used by default with C# file-based Lambda functions the source generator
// based Lambda serializer is used. Ensure the input type and return type used by the function
// handler are registered on the JsonSerializerContext using the JsonSerializable attribute.
[JsonSerializable(typeof(string))]
public partial class LambdaSerializerContext : JsonSerializerContext
{
}

```

ã‚³ãƒ¼ãƒ‰ã¯C#ã®ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã‚’ä½¿ã£ãŸ[Executable assembly handlers](https://docs.aws.amazon.com/lambda/latest/dg/csharp-handler.html#csharp-executable-assembly-handlers)ã‚¹ã‚¿ã‚¤ãƒ«åã«ãªã£ã¦ã„ã‚‹ã®ã§ã€`Main`ãƒ¡ã‚½ãƒƒãƒ‰ã¯ä¸è¦ã§ä»£ã‚ã‚Šã«`await LambdaBootstrapBuilder.Create()`ãŒå¿…è¦ã§ã™ã€‚

`public async Task<string> HandleRequest(T input, ILambdaContext context)`ãŒãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã®ã‚·ã‚°ãƒãƒãƒ£ã§ã™ã€‚ç¬¬ä¸€å¼•æ•°ãŒå—ã‘å–ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆãƒ‡ãƒ¼ã‚¿ã®å‹ã§ã€ç¬¬äºŒå¼•æ•°ãŒ`ILambdaContext`ã§ã™ã€‚ä¸Šè¨˜ã‚³ãƒ¼ãƒ‰ã¯ã€æ–‡å­—åˆ—ã‚’å—ã‘å–ã‚Šå¤§æ–‡å­—ã«å¤‰æ›ã—ã¦è¿”ã™ã®ã§ã€`(string input, ILambdaContext context) => { ... }`ã¨ãªã£ã¦ã„ã¾ã™ã€‚
è¦ã™ã‚‹ã«ã€ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã¯ç¬¬ä¸€å¼•æ•°ã«å—ã‘å–ã‚‹å‹ã€ç¬¬äºŒå¼•æ•°ã«`ILambdaContext`ã‚’æŒ‡å®šã™ã‚Œã°ä»»æ„ã®éåŒæœŸãƒ¡ã‚½ãƒƒãƒ‰ã«ã§ãã‚‹ã¨è€ƒãˆã‚Œã°ã„ã„ã§ã—ã‚‡ã†ã€‚

æ•´ç†ã™ã‚‹ã¨ã€é–‹ç™ºè€…ãŒæ›¸ãéƒ¨åˆ†ã¯2ã‹æ‰€ã§ã™ã€‚

### 1. ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã«å‡¦ç†ã®å®Ÿè£…ã‚’æ›¸ã

Lambdaã§å‡¦ç†ã—ãŸã„å†…å®¹ã¯ã“ã®ãƒãƒ³ãƒ‰ãƒ©ãƒ¼å†…ã«æ›¸ãã¾ã™ã€‚

```cs
var handler = (string input, ILambdaContext context) =>
{
    // ã“ã“ã«å‡¦ç†ã‚’æ›¸ã
};
```

### 2. Lambdaã§å—ã‘å–ã‚‹å…¥åŠ›ã‚’ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã«ç™»éŒ²ã™ã‚‹

ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ãªã—ã§Lambdaã¸ã®å…¥åŠ›ã‚’C#ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¤‰æ›ã™ã‚‹ãŸã‚ã€`System.Text.Json.Serialization`ã®ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã«å‹ã‚’ç™»éŒ²ã—ã¾ã™ã€‚ã“ã‚Œã§ã‚½ãƒ¼ã‚¹ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼ãŒã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚º/ãƒ‡ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã¾ã™ã€‚

ä»Šå›ã¯å…¥åŠ›ãŒæ–‡å­—åˆ—æƒ³å®šãªã®ã§`JsonSerializable(typeof(string))`ã‚’ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã«ç™»éŒ²ã€ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã«æ¥ãŸæ–‡å­—åˆ—ã‚’`ToUpper()`ã§å¤§æ–‡å­—ã«å¤‰æ›ã—ã¦ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã—ã¾ã™ã€‚

```cs
[JsonSerializable(typeof(string))] // ã“ã“ã§å—ã‘å–ã‚‹å‹ã®ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã‚’ç™»éŒ²ã™ã‚‹
public partial class LambdaSerializerContext : JsonSerializerContext
{
}

```

### ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹

Lambdaã«ç›´æ¥.csãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹dotnet tool [Amazon.Lambda.Tools](https://www.nuget.org/packages/Amazon.Lambda.Tools)ãŒã‚ã‚Šã¾ã™ã€‚
ã“ã‚Œã‚’ä½¿ã†ã¨CLIã§ãƒ‡ãƒ—ãƒ­ã‚¤ã§ãã‚‹ã®ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

```shell
$ dotnet tool install -g Amazon.Lambda.Tools
You can invoke the tool using the following command: dotnet-lambda
Tool 'amazon.lambda.tools' (version '6.0.3') was successfully installed.
```

AWSèªè¨¼ã‚’å–å¾—ã—ã¦ãŠãã¾ã™ã€‚

```shell
$ aws sso login --profile your-profile
```

Lambdaé–¢æ•°ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™ã€‚

ã“ã“ãŒå¾“æ¥ã«æ¯”ã¹ã¦å¤§ããå¤‰ã‚ã£ãŸç‚¹ã§ã€`.csproj`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”¨æ„ã›ãšã«`.cs`ãƒ•ã‚¡ã‚¤ãƒ«ã ã‘ã§ãƒ‡ãƒ—ãƒ­ã‚¤ã§ãã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚
ã“ã‚Œãªã‚‰GitHub Actionsãªã©ã®CI/CDç’°å¢ƒã§ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã®ã‚‚ç°¡å˜ã§ã™ã€‚

```shell
$ dotnet lambda deploy-function ToUpper ToUpper.cs --function-runtime dotnet10 --function-role arn:aws:iam::123456789012:role/lambda-function-Role --function-memory-size 256 --function-timeout 10 --profile your-profile
Amazon Lambda Tools for .NET Core applications (6.0.3)
Project Home: https://github.com/aws/aws-extensions-for-dotnet-cli, https://github.com/aws/aws-lambda-dotnet

Architecture not provided, defaulting to x86_64 for container build image.
Executing publish command
Starting container for native AOT build using build image: mcr.microsoft.com/dotnet/sdk:10.0-aot.
... invoking 'docker run --name tempLambdaBuildContainer-3fb48080-a444-499e-b6a4-16413be8c5d0 --rm --volume "C:\github\Lambda\DotnetFileAppFunction":/tmp/source/ -i mcr.microsoft.com/dotnet/sdk:10.0-aot dotnet publish "/tmp/source/ToUpper.cs" --output "/tmp/source\artifacts\ToUpper" --configuration "Release" --framework "net10.0" /p:GenerateRuntimeConfigurationFiles=true --runtime linux-x64 --self-contained True  /p:StripSymbols=true' from directory C:\github\Lambda\DotnetFileAppFunction
... docker run: Unable to find image 'mcr.microsoft.com/dotnet/sdk:10.0-aot' locally
... docker run: 10.0-aot: Pulling from dotnet/sdk
... docker run: 59287b3c3c70: Pulling fs layer
... docker run: 06762f394a85: Pulling fs layer
... docker run: e26f93cf9c70: Pulling fs layer
... docker run: 69c84e01b5c0: Pulling fs layer
... docker run: 47849234c411: Pulling fs layer
... docker run: 505db3b3094b: Pulling fs layer
... docker run: 95c4e06fe864: Pulling fs layer
... docker run: a3629ac5b9f4: Pulling fs layer
... docker run: 60fc5ac8adb0: Pulling fs layer
... docker run: da1a80ccb2fc: Pulling fs layer
... docker run: 46f592c23ae7: Pulling fs layer
... docker run: e26f93cf9c70: Download complete
... docker run: 95c4e06fe864: Download complete
... docker run: da1a80ccb2fc: Download complete
... docker run: 59287b3c3c70: Download complete
... docker run: 47849234c411: Download complete
... docker run: a3629ac5b9f4: Download complete
... docker run: 06762f394a85: Download complete
... docker run: 60fc5ac8adb0: Download complete
... docker run: 46f592c23ae7: Download complete
... docker run: a3629ac5b9f4: Pull complete
... docker run: 47849234c411: Pull complete
... docker run: 95c4e06fe864: Pull complete
... docker run: 46f592c23ae7: Pull complete
... docker run: e26f93cf9c70: Pull complete
... docker run: 59287b3c3c70: Pull complete
... docker run: 60fc5ac8adb0: Pull complete
... docker run: 505db3b3094b: Download complete
... docker run: 69c84e01b5c0: Download complete
... docker run: 69c84e01b5c0: Pull complete
... docker run: da1a80ccb2fc: Pull complete
... docker run: 06762f394a85: Pull complete
... docker run: 505db3b3094b: Pull complete
... docker run: Digest: sha256:d68a5e260330b659f7eae596a255bddbdc4e406e3579eb2d85d718ac58dd7dcb
... docker run: Status: Downloaded newer image for mcr.microsoft.com/dotnet/sdk:10.0-aot
... docker run:   Determining projects to restore...
... docker run:   Restored /tmp/source/ToUpper.csproj (in 13.86 sec).
... docker run:   ToUpper -> /root/.local/share/dotnet/runfile/ToUpper-6855d7fa7559aae751b6be03e6497d359004d36f9f6dae455063950209971e3d/bin/release_linux-x64/ToUpper.dll
... docker run:   Generating native code
... docker run:   ToUpper -> /tmp/source/artifacts/ToUpper/
Zipping publish folder C:\github\Lambda\DotnetFileAppFunction\artifacts\ToUpper to C:\github\Lambda\DotnetFileAppFunction\artifacts\ToUpper.zip
... zipping: ToUpper
Created publish archive (C:\github\Lambda\DotnetFileAppFunction\artifacts\ToUpper.zip).
Creating new Lambda function ToUpper
New Lambda function created
```

arm64ã§å‹•ä½œã•ã›ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ãŒã€NativeAOTã§ã®arm64ãƒ“ãƒ«ãƒ‰ã¯arm64ãƒã‚·ãƒ³ãŒå¿…è¦ã§ã™ã€‚

```shell
# x86_64ãƒã‚·ãƒ³ã§arm64ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹
$ dotnet lambda deploy-function ToUpper-arm64 ToUpper.cs --function-architecture arm64 --function-runtime dotnet10 --function-role arn:aws:iam::123456789012:role/lambda-function-Role --function-memory-size 256 --function-timeout 10
Amazon Lambda Tools for .NET Core applications (6.0.3)
Project Home: https://github.com/aws/aws-extensions-for-dotnet-cli, https://github.com/aws/aws-lambda-dotnet
Host machine architecture (X64) differs from Lambda architecture (Arm64). Building Native AOT Lambda functions require the host and lambda architectures to match.
```

ã¾ãŸã€å¼•æ•°ã‚’æœ€å¾Œã«æŒã£ã¦ã„ãã¨FunctionåãŒ`arm64`ã«ãªã‚‹ã®ã§æ³¨æ„ã§ã™[^2]ã€‚

```shell
# X: ãªãœã‹x86_64ã§ãƒ“ãƒ«ãƒ‰ã•ã‚Œã‚‹ä¸Šã€FunctionåãŒarm64ã«ãªã‚‹
$ dotnet lambda deploy-function ToUpper-arm64 ToUpper.cs --function-runtime dotnet10 --function-role arn:aws:iam::123456789012:role/lambda-function-Role --function-memory-size 256 --function-timeout 10 --function-architecture arm64
```

ãƒ“ãƒ«ãƒ‰ï½ãƒ‡ãƒ—ãƒ­ã‚¤å‡¦ç†ã‚’è¦‹ã¦ã¿ã‚‹ã¨ã€`mcr.microsoft.com/dotnet/sdk:10.0-aot`ã‚³ãƒ³ãƒ†ãƒŠã‚’ä½¿ã£ã¦Native AOTãƒ“ãƒ«ãƒ‰ã—ã¦ã„ã¾ã™ã€‚
ã¾ãŸã€ãƒ“ãƒ«ãƒ‰ã—ãŸãƒã‚¤ãƒŠãƒª`ToUpper`ã‚’zipåŒ–ã—ã¦Lambdaé–¢æ•°ã‚’ä½œæˆã—ã¦ã„ã¾ã™ã€‚ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã®ãƒ•ã‚¡ã‚¤ãƒ«ãƒ„ãƒªãƒ¼ã‚’è¦‹ã¦ã¿ã‚‹ã¨ã€`artifacts`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ãŸToUpper.zipãŒã‚ã‚Šã€ToUpperãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«Native AOTã§ãƒ“ãƒ«ãƒ‰ã•ã‚ŒãŸãƒã‚¤ãƒŠãƒªãŒå…¥ã£ã¦ã„ã¾ã™ã€‚

```shell
.
â”‚  ToUpper.cs
â”‚
â””â”€artifacts
    â”‚  ToUpper.zip
    â”‚
    â””â”€ToUpper
            ToUpper
            ToUpper.dbg
```

ToUpper.zipã®ä¸­èº«ã¯`ToUpper`ãƒã‚¤ãƒŠãƒªã ã‘ãŒå…¥ã£ã¦ã„ã¾ã™ã€‚

```shell
$ unzip -l artifacts/ToUpper.zip
Archive:  artifacts/ToUpper.zip
  Length      Date    Time    Name
---------  ---------- -----   ----
  6925632  1980-00-00 00:00   ToUpper
---------                     -------
  6925632                     1 file
```

ã“ã®ã“ã¨ã‹ã‚‰ã€ãƒ•ã‚¡ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹ã®C# Lambdaé–¢æ•°ã¯å¾“æ¥é€šã‚ŠzipåŒ–ã•ã‚ŒãŸãƒã‚¤ãƒŠãƒªã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚

### å‹•ä½œç¢ºèªã™ã‚‹

ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚ŒãŸçµæœã§ã™ã€‚

[f:id:guitarrapc_tech:20260114160833p:plain:alt=Lambdaã‚³ãƒ³ã‚½ãƒ¼ãƒ«]<!--image-2.png-->

Lambda Handlerã¯`ToUpper`ã«è¨­å®šã•ã‚Œã¾ã™ã€‚é€šå¸¸C#ã®å ´åˆã¯`Namespace.ClassName::MethodName`ã®å½¢å¼ã§ã™ãŒã€ãƒ•ã‚¡ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹ã®å ´åˆã¯åå‰ç©ºé–“ã‚„ã‚¯ãƒ©ã‚¹åãŒçœç•¥ã•ã‚Œç›´æ¥ãƒã‚¤ãƒŠãƒªåã«ãªã‚Šã¾ã™ã€‚

[f:id:guitarrapc_tech:20260114160841p:plain:alt=Lambda Handlerã¯ToUpper]<!--image-1.png-->

å®Ÿè¡Œã—ã¦ã¿ã‚‹ã¨ã€ToUpperé–¢æ•°ãŒå‹•ä½œã—ã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚ãƒ†ã‚¹ãƒˆã‚¤ãƒ™ãƒ³ãƒˆã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«è¨­å®šã—ã¾ã™ã€‚

```json
"foobar"
```

å®Ÿè¡Œã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ã«è¿”ã£ã¦ãã¾ã™ã€‚

```json
"FOOBAR"
```

[f:id:guitarrapc_tech:20260114160848p:plain:alt=Functionã®å®Ÿè¡Œçµæœ]<!--image.png-->

ã„ã„æ„Ÿã˜ã§ã™ã­ã€‚

## JSONã‚’å…¥åŠ›ã™ã‚‹

å…ˆã»ã©ã®ä¾‹ã§ã¯æ–‡å­—åˆ—ã‚’å—ã‘å–ã‚‹å˜ç´”ãªã‚±ãƒ¼ã‚¹ã§ã—ãŸãŒã€å®Ÿéš›ã®Lambdaé–¢æ•°ã§ã¯JSONã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æ‰±ã†ã“ã¨ãŒå¤šã„ã§ã—ã‚‡ã†ã€‚
ç¾åœ¨ã®ã‚³ãƒ¼ãƒ‰ã®ã¾ã¾JSONã‚’ä¸ãˆã‚‹ã¨ä¾‹å¤–ãŒç™ºç”Ÿã—ã¾ã™ã€‚

```json
{
  "key1": "value1",
  "key2": "value2",
  "key3": "value3"
}
```

Lambdaã‚’å®Ÿè¡Œã™ã‚‹ã¨ä¾‹å¤–ãƒ­ã‚°ãŒå‡ºã¾ã™ã€‚

```shell
START RequestId: 08c68f6d-02c2-4d55-b4e9-3f1aba3acbf9 Version: $LATEST
2026-01-14T06:09:44.113Z	08c68f6d-02c2-4d55-b4e9-3f1aba3acbf9	fail	Amazon.Lambda.Serialization.SystemTextJson.JsonSerializerException: Error converting the Lambda event JSON payload to type System.String: The JSON value could not be converted to System.String. Path: $ | LineNumber: 0 | BytePositionInLine: 1.
 ---> System.Text.Json.JsonException: The JSON value could not be converted to System.String. Path: $ | LineNumber: 0 | BytePositionInLine: 1.
 ---> System.InvalidOperationException: Cannot get the value of a token type 'StartObject' as a string.
   at System.Text.Json.ThrowHelper.ThrowInvalidOperationException_ExpectedString(JsonTokenType) + 0x19
   at System.Text.Json.Utf8JsonReader.GetString() + 0xa5
   at System.Text.Json.Serialization.JsonConverter`1.TryRead(Utf8JsonReader&, Type, JsonSerializerOptions, ReadStack&, T&, Boolean&) + 0x1e8
   at System.Text.Json.Serialization.JsonConverter`1.ReadCore(Utf8JsonReader&, T&, JsonSerializerOptions, ReadStack&) + 0x81
   --- End of inner exception stack trace ---
   at System.Text.Json.ThrowHelper.ReThrowWithPath(ReadStack&, Utf8JsonReader&, Exception) + 0x48
   at System.Text.Json.Serialization.JsonConverter`1.ReadCore(Utf8JsonReader&, T&, JsonSerializerOptions, ReadStack&) + 0x21b
   at System.Text.Json.Serialization.Metadata.JsonTypeInfo`1.Deserialize(Utf8JsonReader&, ReadStack&) + 0x26
   at System.Text.Json.JsonSerializer.ReadFromSpan[TValue](ReadOnlySpan`1, JsonTypeInfo`1, Nullable`1) + 0xd6
   at Amazon.Lambda.Serialization.SystemTextJson.SourceGeneratorLambdaJsonSerializer`1.InternalDeserialize[T](Byte[]) + 0x78
   at Amazon.Lambda.Serialization.SystemTextJson.AbstractLambdaJsonSerializer.Deserialize[T](Stream) + 0x183
   --- End of inner exception stack trace ---
   at Amazon.Lambda.Serialization.SystemTextJson.AbstractLambdaJsonSerializer.Deserialize[T](Stream) + 0x229
   at Amazon.Lambda.RuntimeSupport.HandlerWrapper.<>c__DisplayClass44_0`2.<GetHandlerWrapper>b__0(InvocationRequest invocation) + 0x45
   at Amazon.Lambda.RuntimeSupport.LambdaBootstrap.<>c__DisplayClass26_0.<<InvokeOnceAsync>b__0>d.MoveNext() + 0x1d5
END RequestId: 08c68f6d-02c2-4d55-b4e9-3f1aba3acbf9
REPORT RequestId: 08c68f6d-02c2-4d55-b4e9-3f1aba3acbf9	Duration: 55.06 ms	Billed Duration: 56 ms	Memory Size: 256 MB	Max Memory Used: 37 MB
```

ã“ã‚Œã«å¯¾å¿œã™ã‚‹ã«ã¯ã€å…¥åŠ›JSONã‚’è¡¨ã™C#ã‚¯ãƒ©ã‚¹ã‚’ç”¨æ„ã—ã€ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã«ç™»éŒ²ã—ã¾ã™ã€‚

```cs
[JsonSerializable(typeof(HelloWorldEvent))]
//[JsonSerializable(typeof(string))]
public partial class LambdaSerializerContext : JsonSerializerContext
{
}

public record HelloWorldEvent
{
    [JsonPropertyName("key1")]
    public required string Key1 { get; init; }
    [JsonPropertyName("key2")]
    public required string Key2 { get; init; }
    [JsonPropertyName("key3")]
    public required string Key3 { get; init; }
}
```

å—ã‘å–ã£ãŸHelloWorldEventã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½¿ã†ã‚ˆã†ã«ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã‚’æ›¸ãæ›ãˆã¾ã™ã€‚

```cs
var handler = (HelloWorldEvent input, ILambdaContext context) =>
{
    return $"{input.Key1}, {input.Key2}, {input.Key3}".ToUpper();
};
```

å¤‰æ›´å¾Œã®ToUpper.csã®ã‚³ãƒ¼ãƒ‰ã¯æ¬¡ã®é€šã‚Šã§ã™ã€‚

```cs
#:package Amazon.Lambda.Core@2.8.0
#:package Amazon.Lambda.RuntimeSupport@1.14.1
#:package Amazon.Lambda.Serialization.SystemTextJson@2.4.4

#:property TargetFramework=net10.0

using Amazon.Lambda.Core;
using Amazon.Lambda.RuntimeSupport;
using Amazon.Lambda.Serialization.SystemTextJson;
using System.Text.Json.Serialization;

// ğŸ‘‡ HelloWorldEventã‚’å—ã‘å–ã‚‹ã‚ˆã†ã«æ›¸ãæ›ãˆã‚‹
var handler = (HelloWorldEvent input, ILambdaContext context) =>
{
    return $"{input.Key1}, {input.Key2}, {input.Key3}".ToUpper();
};

await LambdaBootstrapBuilder.Create(handler, new SourceGeneratorLambdaJsonSerializer<LambdaSerializerContext>())
    .Build()
    .RunAsync();

// ğŸ‘‡ ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã«HelloWorldEventã‚’ç™»éŒ²ã™ã‚‹
[JsonSerializable(typeof(HelloWorldEvent))]
public partial class LambdaSerializerContext : JsonSerializerContext
{
}

// ğŸ‘‡ JSONã‚’è¡¨ã™C#ã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ 
public record HelloWorldEvent
{
    [JsonPropertyName("key1")]
    public required string Key1 { get; init; }
    [JsonPropertyName("key2")]
    public required string Key2 { get; init; }
    [JsonPropertyName("key3")]
    public required string Key3 { get; init; }
}
```

ã“ã‚Œã§å—ã‘å–ã£ãŸJSONã®å€¤ã‚’å¤§æ–‡å­—ã«å¤‰æ›ã—ã¦è¿”ã›ã¾ã™ã€‚

```json
{
  "key1": "value1",
  "key2": "value2",
  "key3": "value3"
}
```

[f:id:guitarrapc_tech:20260114160857p:plain:alt=JSONã‚’å—ã‘å–ã£ã¦å¤§æ–‡å­—ã§è¿”ã™]<!--image-3.png-->

## IaCã‹ã‚‰ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹

Pulumiã®AWS SDKã§ã‚‚ãƒ•ã‚¡ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®C# Lambdaé–¢æ•°ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã§ãã¾ã™ã€‚
ãŸã ã€dotnet toolã‹ã‚‰ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã¨é•ã£ã¦æ˜ç¤ºçš„ã«äº‹å‰ãƒ“ãƒ«ãƒ‰ãŒå¿…è¦ãªã®ã§å¾®å¦™ã§ã™ã€‚

ã‚¬ãƒ¯ã ã‘IaCã§ä½œã£ã¦ãŠã„ã¦Codeã¯Ignoreã€é–¢æ•°è‡ªä½“ã¯åˆ¥é€”ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãŸã»ã†ãŒæ‰±ã„ã‚„ã™ã„ã§ã™ã€‚

```cs
var name = "dotnet-file-based-lambda";
var functionName = "ToUpper";
var handlerName = "ToUpper";
var functionCodePath = "Lambda/DotnetFileAppFunction/artifacts/ToUpper/ToUpper"; // äº‹å‰ã«ãƒ“ãƒ«ãƒ‰ã—ã¦ãŠã„ãŸãƒã‚¤ãƒŠãƒªã®ãƒ‘ã‚¹
var roleArn = "arn:aws:iam::123456789012:role/lambda-function-Role";

var lambdaHash = HashHelper.CreateHashSha256(functionCodePath);

var cloudwatchLogs = new Pulumi.Aws.CloudWatch.LogGroup($"{name}-lambda-loggroup", new()
{
    Name = $"/aws/lambda/{functionName}",
    RetentionInDays = 7,
}, opt);

var lambda = new Pulumi.Aws.Lambda.Function($"{name}-lambda-function", new()
{
    Name = functionName,
    Description = AwsConstants.Descriptions.Default,
    Code = new FileArchive(Directory.GetParent(functionCodePath)!.FullName.NormalizePath()),
    Role = roleArn,
    Runtime = "dotnet10",
    Handler = handlerName,
    Timeout = 10,
    SourceCodeHash = lambdaHash,
}, opt);
```

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã«ã¤ã„ã¦

[AWS Blog](https://aws.amazon.com/jp/blogs/compute/net-10-runtime-now-available-in-aws-lambda/)ã§ã€.NET 8ã«æ¯”ã¹ã¦.NET 10ãŒãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ä½ä¸‹ã™ã‚‹ã‚±ãƒ¼ã‚¹([#120288](https://github.com/dotnet/runtime/issues/120288#issuecomment-3747281696))ã«ã¤ã„ã¦è¨€åŠã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã‚Œã«é–¢ã—ã¦ã¯ã€.NET 10.0.2ã§è§£æ¶ˆã—ãŸã¨ã®ã“ã¨ãªã®ã§ã€å®‰å¿ƒã§ããã†ã§ã™ã€‚

[f:id:guitarrapc_tech:20260114160906p:plain:alt=.NET 10.0.2ã§ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ä½ä¸‹ãŒæ”¹å–„]<!--image-4.png-->

## ã¾ã¨ã‚

AWS LambdaãŒ.NET 10ã‚’ã‚µãƒãƒ¼ãƒˆã—ãŸã“ã¨ã§ã€ãƒ•ã‚¡ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®C# Lambdaé–¢æ•°ãŒä½¿ãˆã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚
`.cs`ãƒ•ã‚¡ã‚¤ãƒ«ã ã‘ã§Lambdaé–¢æ•°ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã§ãã‚‹ã®ã§ã€C#ã§ã®Lambdaé–‹ç™ºãŒã‹ãªã‚Šæ‰‹è»½ã«ãªã‚Šã¾ã™ã€‚

C#ã®ãƒ©ãƒ ãƒ€é–¢æ•°ã¯ã€Pythonã‚„Node.jsã«æ¯”ã¹ã¦ãƒ“ãƒ«ãƒ‰ãŒå¿…è¦ã§ã€C#ã‚’æ„è­˜ã™ã‚‹ã®ã¯ãŠæ‰‹è»½ã˜ã‚ƒãªã„ã¨æ„Ÿã˜ã¦ã„ã¾ã—ãŸã€‚Pythonã‚„Node.jsã®ã‚ˆã†ãªæ‰‹è»½ã•ã§C#ãŒæ›¸ã‘ã‚‹ã®ã¯å¬‰ã—ã„å¤‰åŒ–ã§ã™ã€‚
.NET 10ã«ãŠã‘ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¯å‰²ã¨è‰¯ã„æ„Ÿã˜ãªã®ã§ã€ãœã²è©¦ã—ã¦ã¿ã¦ãã ã•ã„ã€‚

## å‚è€ƒ

- [AWS Lambda adds support for .NET 10 | AWS](https://aws.amazon.com/jp/about-aws/whats-new/2026/01/aws-lambda-dot-net-10/)
- [.NET 10 runtime now available in AWS Lambda | AWS Compute Blog](https://aws.amazon.com/jp/blogs/compute/net-10-runtime-now-available-in-aws-lambda/)
- [Executable assembly handlers - Define Lambda function handler in C# | AWS Docs](https://docs.aws.amazon.com/lambda/latest/dg/csharp-handler.html#csharp-executable-assembly-handlers)
- [#120288 - Detecting .NET 10 Regression in startup performance affecting AWS Lambda #120288 - dotnet/runtime | GitHub](https://github.com/dotnet/runtime/issues/120288#issuecomment-3747281696)
- [.NET10ã®dotnet run app.csã§ãƒ•ã‚¡ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’å®Ÿè¡Œã™ã‚‹ | tech.guitarrapc.com](https://tech.guitarrapc.com/entry/2025/04/11/235900)

[^1]: ç§ã¯ã‚³ãƒ”ãƒ¼&ãƒšãƒ¼ã‚¹ãƒˆã§æ›¸ã„ã¦ã‚‹
[^2]: ã‚³ãƒãƒ³ãƒ‰ã®é€”ä¸­ã«`--function-architecture arm64`ã‚’å…¥ã‚Œã‚‹ã¨å›é¿ã§ãã¾ã™
