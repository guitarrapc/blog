---
Title: Windows 11 Professional マシンを構成する
Category:
- Windows
Date: 2023-04-13T04:00:00+09:00
URL: https://tech.guitarrapc.com/entry/2023/04/18/759984
EditURL:
---

Windows マシンを更新したので、構成メモです。

# tl;dr;

- Windows のツールセットアップは [local-provisioner](https://github.com/guitarrapc/local-provisioner) と [SccopPlaybook](https://github.com/guitarrapc/ScoopPlaybook) にお任せ。
- (課題) インストーラーを使う、Visual Studio、Docker Desktop、Logicool Options+、Realforce Driver が自動化できていない。
- (課題) Windows のユーザー名を指定したいので、Microsoft Account での初期ユーザー作成を避けたいが Wifi だとちょっと悩ましい。
- (課題) Windows の初期設定も macOS の defaults のように構成していきたいが、定義はYAMLに書いたり冪等性を担保したい。が、Ansible は使いたくない。

# Windows マシンの構成

## 前準備

- UEFI: Hyper-V を使うため、 CPU > Advanced で `Intel VT` や `AMD SVM` を有効にします。
- OS: Windows 11 Professional をクリーンインストールします。

> Windows 10 からのアップグレードでは発生しないドライバー認識問題がおこるので、Windows 11 でクリーンインストールは大事。

# 流れ

私の環境の場合、次のように行っています。

1. Wifi に接続。
2. (Windows) Windows 初期サインアップは Microsoft Account で行う。(LAN/Wifi を切るのは面倒なのであきらめている)
3. (Windows) ローカルアカウント (Administrators Group) を作成する。
4. (Windows) Microsoft アカウントとの Windows ユーザーをサインアウト、ローカルアカウントでWindows サインイン。
5. (Windows) English の言語パックを追加、IME は日本語に。 [^1]
6. (Windows) Windows 初期サインアップで作った Microsoft アカウントの Windows ユーザーを削除。
7. (Windows) Windows の ローカルアカウント を Microsoft アカウントと紐づけ。
8. (Windows) Windows を Developer mode (開発者モード) で設定。 [^2]
9. (Windows) Windows Update を一回あてる。
10. (ツール) [Scoop をインストール](https://scoop.sh/)。
11. (ツール) git を scoop でインストール。 [^3]
12. (ツール) Windowsアプリを [guitarrapc/local-provisioner](https://github.com/guitarrapc/local-provisioner) で構成。
13. (Windows) ネットワークプロファイルを Private に設定。 [^4]
14. (Windows) Windows に [Yubikey Bio を設定](https://www.yubico.com/setup/yubikey-bio-series/)。
15. (ツール) Chome にサインアップ。デフォルトブラウザを Edge から Chrome に変更。
16. (ツール) Chrome 拡張の [uBlacklist のサブスクリプションを構成](https://github.com/guitarrapc/ublacklist-subscription)。
17. (Windows) Night lightを有効化。 Stlength 50%、時間は 21:00 til 7:00。
18. (Windows) Display scale を 100% に設定、縦モニターは portlait (flipped) に設定。
19. (ツール) VSCode Sync の有効化。
20. (ツール) Visual Studio の構成。 [^5]
21. (ツール) WSL & WSL2 の構成。 [^4]
22. (Windows) LongPath の有効化。 [^4]
23. (ツール) Docker desktop のインストール。[^6]
24. (Windows) Bluetooth機器のペアリング、 Dynamic Lock の有効化。
25. (Windows) Startup apps の無効化 を TaskManagerで行う。 [^7]
26. (Windows) そのほかドライバーの構成。 [^8]

# パーツのメモ

**メモリのクロック制約**

メモリを 128GB (DDR-4800) で組んでいます。しかし、Ryzen 7000シリーズはメモリ4チャンネル (4枚差し)をするとクロックが DDR5-3200 まで落ちるのでそれは許容しています。
64GB だと足りないので仕方ない。

**セミファンレス電源**

Fractal Design ION+2 Platinum を採用しました。セミファンレスにできるのですが、実際電源周りは静かかつ、普段はファン起動していないのでいいかんじでですね。
今のところ違和感なく、モジュラー + ケーブルがやわらかいので大変良いです。

**Samsung 990 PRO**

採用を見送りました。Ryzen 7000 シリーズだと ランダムの Write がおかしいと思っててちょっと避けたいと思いました。

> [【やじうまミニレビュー】Samsungの新SSD「990 PRO」自腹購入。Ryzenだとさらに速い！涼しい！ - PC Watch](https://pc.watch.impress.co.jp/docs/column/yajiuma-mini-review/1470928.html)

インテルなら問題ないようなのでいいのではないでしょうか。

> [「Samsung SSD 990 PRO 1TB」をレビュー。性能も電力効率もトップクラス！ : 自作とゲームと趣味の日々](https://jisakuhibi.jp/review/samsung-ssd-990-pro-1tb)

代わりに WD_BLACK SN850X を用いています。個人的には、ここ2年で WD_BLACK がバランスよく早いのでいい感じと思います。

> [「WD_BLACK SN850X NVMe SSD 1TB / 2TB」をレビュー。SN850よりも高速なのに低消費電力！ : 自作とゲームと趣味の日々](https://jisakuhibi.jp/review/wd_black-sn850x-nvme-ssd-1tb-and-2tb)


[^1]: 日本語キーボードを使う場合、IME は日本語にしておくと Windows の表示言語にかかわらずキーボードで困らない。
[^2]: 開発者モードにすると、mklink が管理者権限不要になる、PowerShell のRemote Signed も有効にできるのがおいしい。
[^3]: `scoop install git`
[^4]: local-provisioner の envs/windows/etc にスクリプトがある。
[^5]: 2023/Apr 時点では Visual Studio 2022。
[^6]: Hyper-V バックエンド、localhost:2375 の有効化、Kubernetes の有効化。
[^7]: Microsoft Teams, OneDrive, Radeon Software Startup Task。
[^8]: CM02, Realforce and Logcool Options+.
