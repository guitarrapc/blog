---
Title: hatena/hatenablog-workflowsを使ったり使わなかったりする話
Category:
- CI/CD
Date: 2025-04-06T23:59:00+09:00
EditURL: https://blog.hatena.ne.jp/guitarrapc_tech/guitarrapc-tech.hatenablog.com/atom/entry/6802418398411400751
PreviewURL: https://tech.guitarrapc.com/draft/entry/dh66pibQbSw7dg4EoH1Ghqq2iOk
CustomPath: 2025/04/06/235900
Draft: true
---

以前はてなブログをGitHubを連動させている[話](https://tech.guitarrapc.com/entry/2025/01/04/235952)を書きましたが、はてなブログ提供のGitHub Actionsを直接使ったり使わなくなっているので、最近の運用方法をまとめておきます。

[:contents]

# はてなブログのワークフロー

[はてなブログのボイラーテンプレート](https://github.com/hatena/Hatena-Blog-Workflows-Boilerplate/)は、はてなが提供しているReusable Workflow[hatena/hatenablog-workflows](https://github.com/hatena/hatenablog-workflows)を使っています。
はてな管理のワークフローが実処理を担っているため、利用者はボイラーテンプレートを使うだけで済むという方針ですね。

実際割とよく機能するのですが、課題がいくつかあり、私はワークフローを直接使わない方向に修正して運用しています。

# 課題

## ワークフローがタグ指定

さて、はてなReusable Workflowはタグで指定しています。このため、昨今のSHA指定でないとまずいという流れを考えると微妙な状況です。
ボイラーテンプレートのREADMEには、`workflowの変更は原則 Reusable workflows を変更するため基本的には更新は不要です`と書いてありますが、それはタグ指定しておりv1から変えないことを暗黙的に示唆しています。

![はてなブログのバージョン](image.png)

この方針は2つのシーンで破綻します。

1. Reusable Workdlowが使っているアクションで脆弱性があった時にユーザーは回避できない
2. はてなブログワークフロー自身を固定する想定がない

先日のtj-actions/changed-filesの脆弱性CVE-2025-30066が発表されたとき、はてなブログのボイラーテンプレートはこれをタグで指定したため影響を受ける状況でした。脆弱性発生が土曜、[SHAに切り替える修正](https://github.com/hatena/hatenablog-workflows/pull/94)は月曜に入ったのですが、はてなが管理しているため土日は修正されないままでした。[Issue](https://github.com/hatena/hatenablog-workflows/issues/93)で脆弱性共有はあげたものの、PRをあげても週末にマージされないのは分かっていたためこのタイミングで私は自前ワークフローへの変更に切り替えました。なお、現在もはてなブログのボイラーテンプレートからワークフロー参照はv1タグを使っており、SHA指定されていません。

ユーザーがワークフローを固定するときも、v1で運用する想定なのはちょっと微妙です。初めからSHA指定にしておいてDependabotで自動更新するようにテンプレート展開するほうがいいでしょうね。

## ワークフローやアクションに手を入れられない

Reusable Workflowでやっている処理に手を入れたいとき、変更が受け入れられない場合もあります。
私は`tj-actions`をバンしたので、他のアクションに切り替えましたが、はてなブログのボイラーテンプレートは`tj-action/changed-files`そのまま使う方針です。

こういった方針の違いは当然ありますし、その場合はフォークするか自前でワークフローを持つしかないでしょう。それはそういうものです。
