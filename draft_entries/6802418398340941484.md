---
Title: PowerShell で 共有ドライブ(マップドライブ)を作成する
Category:
- PowerShell
Date: 2013-07-08T23:10:43+09:00
EditURL: https://blog.hatena.ne.jp/guitarrapc_tech/guitarrapc-tech.hatenablog.com/atom/entry/6802418398340941484
PreviewURL: https://tech.guitarrapc.com/draft/entry/mqbcz_klpTOU0fpuWlihEQLfo9U
CustomPath: 2013/07/08/231043
---

<!--
Date: 2013-07-08T23:10:43+09:00
URL: https://tech.guitarrapc.com/entry/2013/07/08/231043
-->

なんだかずいぶん手間のかかることをしている記事を見かけたのですが、ん～、そこまでしなくてもと思っちゃったので一応サンプルを。
`net use`を使え?仰る意味がわかりません。

## PowerShell 2.0 でのサンプル

見かけたのは、こんな例でした。

```ps1
   [CmdletBinding()]
   param(
      [string]$driveletter,
      [string]$path,
      [switch]$persistent
   )
   process{
      $nwrk=new-object -com Wscript.Network
      Write-Verbose "Mapping $($driveletter+':') to $path and persist=$persistent"
      try{
         $nwrk.MapNetworkDrive($($driveletter+':'),$path)
         Write-Verbose "Mapping successful."
      }
      catch{
         Write-Verbose "Mapping failed!"
      }
   }
```


ないです。

こんなのも見かけました。
つらいですね。

```ps1
$Network = New-Object -ComObject "Wscript.Network"
$Network.MapNetworkDrive("P:", "\\MyComputer\MyShare")
```


なおリストアップはこれで

```ps1
(New-Object -Com WScript.Network).EnumNetworkDrives()
```


削除はこれで

```ps1
(New-Object -Com WScript.Network).RemoveNetworkDrive("P:")
```


ほげ～。

## PowerShell 3.0 でのサンプル
PowerShell 3.0から New-PSDriveで出来ます。
-Persist パラメータをつけないと、そのPSセッションのみ利用されますが、-Peristによりセッション終了後も利用できるのです。

```ps1
$SharePath = "\\共有したいドライブパス"
$DriveName = "空いてるドライブ名"
if(-not ((Get-PSDrive).DisplayRoot -contains $SharePath))
{
  New-PSDrive -Name $DriveName -PSProvider FileSystem -Root $SharePath -Persist
}
```


色々好きに処理すればいいと思います。

## SampleSource
ごくごく簡単ですが。
https://github.com/guitarrapc/PowerShellUtil/blob/master/Set-ShareDrive/SEt-ShareDrive.ps1
