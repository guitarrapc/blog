---
Title: AWS IAM Identity CenterをPulumiで構成する
Category:
- C#
- Pulumi
- AWS
Date: 2025-03-25T23:59:00+09:00
EditURL: https://blog.hatena.ne.jp/guitarrapc_tech/guitarrapc-tech.hatenablog.com/atom/entry/6802418398344602127
PreviewURL: https://tech.guitarrapc.com/draft/entry/Q8v22ZHshIbDiyVSDuY1m6pbaR0
CustomPath: 2025/01/01/000000
Draft: true
---

AWS IAM Identity CenterをTerraformで構成するときは[aws-ia/terraform-aws-iam-identity-center](https://github.com/aws-ia/terraform-aws-iam-identity-center)が便利です。
同様にPulumiでも構成してみましょうという回です。

[:contents]

# どのような構成にするのか

AWS IAM Identity CenterはAWSのSSO機能です。SSOの連携IdPとしてGoogle IdPやMicrosoft Entra IDなどいろいろ選べます。
今回は簡単のため、SSOなしでIAM Identity Center単独ディレクトリとして構成します。

全体像は次の通りです。これでアクセスポータルにアクセスした際、ログインしたユーザーごとに任意のアカウントへ任意の権限でアクセスできるようになります。

* アカウントはmaster、serviceAの2つがある
* masterアカウントでIAM Identity Centerを構成する
* IAM Identity Centerは、アカウントごとにグループと権限セットを構成する
* 権限セットはAdminとViewOnlyの2つ
* グループと権限セットの命名はともに`アカウント名_権限名`とする
* 全ユーザーは必要な権限ごとにグループへ紐づける

<details>
<summary>mermaidコード</summary>

```mermaid
flowchart TD
  subgraph access[アクセスポータル]
    url[example.awsapps.com/start]
  end
  subgraph master[masterアカウント]
    subgraph iam[IAM Identity Center]
      subgraph ユーザー
        user1[foo]
        user2[bar]
      end
      subgraph for_master[masterアカウント用]
        subgraph group_master[グループ]
          group1[master_Admin]
          group2[master_ViewOnly]
        end
        subgraph permission_master[権限セット]
          permission1[master_Admin]
          permission2[master_ViewOnly]
        end
      end
      subgraph for_serviceA[serviceAアカウント用]
        subgraph group_serviceA[グループ]
          group3[serviceA_Admin]
          group4[serviceA_ViewOnly]
        end
        subgraph permission_serviceA[権限セット]
          permission3[serviceA_Admin]
          permission4[serviceA_ViewOnly]
        end
      end
      subgraph account[アカウント]
        account_master[masterアカウント]
        account_serviceA[serviceAアカウント]
      end
    end
  end
  subgraph serviceA[serviceAアカウント]
    ec2_2[ec2]
    ecs_2[ecs]
    lambda_2[lambda]
    s3_2[s3]
  end

  user1 -.-> group1
  user1 -.-> group3
  user2 -.-> group2
  user2 -.-> group4

  group1 -.-> account_master
  group2 -.-> account_master
  permission1 -.-> account_master
  permission2 -.-> account_master

  group3 -.-> account_serviceA
  group4 -.-> account_serviceA
  permission3 -.-> account_serviceA
  permission4 -.-> account_serviceA

  browser --> access
  access --> master
  access --> serviceA
```

</details>

[f:id:guitarrapc_tech:20250415043556p:plain:alt=全体構成図]
