---
Title: ドキュメント翻訳をCopilotで自動化する
Category:
- GitHubActions
Date: 2025-12-23T23:00:00+09:00
EditURL: https://blog.hatena.ne.jp/guitarrapc_tech/guitarrapc-tech.hatenablog.com/atom/entry/17179246901335843786
PreviewURL: https://tech.guitarrapc.com/draft/entry/eprpS6oucJo5AS6jP34qHsobmfE
CustomPath: 2025/12/23/230000
Draft: true
---

GitHubで管理しているドキュメントは、たびたび多言語対応したくなります。
今回はその翻訳をCopilotを使って自動化する方法についてです。

[:contents]

## まとめ

はじめにまとめです。

- GitHub Issueを使ってGitHub Copilotエージェントにドキュメント翻訳タスクをさせると翻訳を任せられる
- GitHub IssueへのGitHub Copilotアサインには、Copilotライセンス付きのユーザーパストークンが必要
- GitHub Copilotにどう翻訳をさせるかは、インストラクションで指示、Issueボディで調整できる

## 多言語翻訳は維持が難しい

ドキュメント管理で難しいことの1つが多言語対応です。
自分がある言語Aのネイティブかどうかによらず、同じドキュメントを複数言語で差異鳴くメンテし続けるのは想像よりも大変です。

私の場合、GitHubリポジトリのREADMEは基本的に英語で書かれていますが、中には日本語READMEや中国語READMEなど利用ユーザーに合わせた翻訳版を用意したいことがあります。
とはいえREADMEの内容が更新されるたびに、各言語版を漏れなく・文書構造を維持したまま翻訳追随するのは、手作業ではかなり困難といわざるを得ません。

例えば次のような英語文章があったとして、ごく一部だけ変化したとしましょう。

```
# 適当な長い技術文章 (before)
When working with GitHub repositories, it is common to encounter the need for multi-language documentation. Maintaining consistency across different language versions can be challenging, especially when updates are frequent.

# 一部だけ文章を修正する (after)
When working with GitHub repositories, it is common to encounter the need for multi-language documentation. Keeping consistency across different language versions can be challenging, especially when updates are frequent and require careful attention.
```

多言語対応するということは、この変更を他言語版にも反映させる必要があります。多言語対応の難しいところは、文章入れ替え、追加、削除だけではなく、ニュアンスの違いなども考慮しなければならない点です。

```
# 適当な長い技術文章の日本語訳 (before)
GitHubリポジトリを扱う際、多言語ドキュメントの必要性に直面することがよくあります。異なる言語バージョン間での一貫性を維持することは、特に更新が頻繁な場合、困難です。

# 変更を反映させた日本語訳 (after)
GitHubリポジトリを扱う際、多言語ドキュメントの必要性に直面することがよくあります。異なる言語バージョン間での一貫性を維持することは、特に更新が頻繁で注意が必要な場合、困難です。
```

## LLMの翻訳補助

このような多言語翻訳を維持する1つの手段は、LLM（大規模言語モデル）による翻訳補助です。
GitHubの場合、こういったドキュメント記述タスクにGitHub Copilotエージェントを割り当てるのは想定された[ユースケースの一つ](https://learn.microsoft.com/ja-jp/training/modules/developer-use-cases-for-ai-with-github-copilot/2-boost-developer-productivity)です。

[f:id:guitarrapc_tech:20251224181808p:plain:alt=GitHub Copilotのユースケース例]<!--image.png-->

ただ、何も補助なしでCopilotエージェントに翻訳を任せるのは微妙です。

- どこまで翻訳するか、どのような基準で翻訳するかが安定しない
- コードやリンクなど意図しない箇所が翻訳されえる
- 固有語句の翻訳ニュアンスがずれえる
- ドキュメント毎の言語やスタイルの違い対応が一貫性を欠く

このため、インストラクションを与えて翻訳基準を明確にすると良いです。

- 翻訳対象ドキュメントとその言語を判断を指示する
- 翻訳すべき箇所と翻訳すべきでない箇所を明示する (コードブロック、リンク、固有名詞は翻訳しないなど)
- ドキュメント後の翻訳スタイルや一貫性を具体的に指示する

## GitHub Copilotを用いたドキュメント翻訳の自動化

翻訳作業を記録・任意の指示するため、GitHub Issueを使ってCopilotエージェントに翻訳タスクを割り当てると、翻訳PRで結果をレビューしやすくなります。

ということで、私が実際に使っている多言語READMEの翻訳フローは次の通りです。

- GitHub Actionsでドキュメント翻訳用のIssueを自動作成する
- Issueへのラベル付与をトリガーに、GitHub ActionsでCopilotエージェントをアサインする
- CopilotエージェントがIssue内容に基づき、ドキュメントを翻訳する

普段の定型指示はGitHub Actionsワークフローに組み込み、Issue作成からCopilotエージェントのアサインまで自動化しています。Issueで細かい指示をするので、Issueの文章を変えれば翻訳タスクの内容を調整できます。

それでは、これを構築してみましょう。

1. Copilotライセンス付きユーザーでPATを生成
2. インストラクションを用意する
3. GitHub Actionsワークフローを用意する

### Copilotライセンス付きユーザーでPATを生成

GitHub Actionsで、IssueにCopilotエージェントをアサインするには[gh](https://github.com/cli/cli)を使います。ghでIssueにCopilotエージェントをアサインするには、Copilotライセンス付きユーザーのPATが[必要です](https://github.com/cli/cli/issues/11362)。`GITHUB_TOKEN`やGitHub Appインストレーショントークンではアサインできません。

今回はIssueを作らせて作業するので、PATにIssueスコープを与えます。

- Contents: read
- Issue: read & write

生成したPATは、GitHubリポジトリのシークレットに登録します。ここでは`GITHUB_TOKEN_COPILOT`という名前で登録します。

### インストラクションを用意する

ドキュメント翻訳の基準を明確にするため、GitHub Copilotエージェントに与えるインストラクションを用意します。
私は以下のようなインストラクションを用意しています。

インストラクションは、「翻訳対象ドキュメントとその言語判断を指示する」「ドキュメント後の翻訳スタイルや一貫性を具体的に指示する」を重視しています。どのようなタスクにするかは、Issueで調整するので、インストラクションは翻訳品質や基準に集中させます。

```md
## Documentation Review Guidelines

When reviewing changes to documentation, focus on the following points:

- Spelling
- Clarity and Conciseness
  - Ensure the content is written in a clear and concise manner.
- Headings
  - Check that appropriate headings are used.
- Documentation Style
  - The writing style must be consistent with existing documentation.
  - Documentation is not a personal blog post. The subject is the project itself, and the project provides content to the reader.
- Language Consistency
  - Each language-specific document (e.g., README-ja.md for Japanese) must be written entirely in that language.
  - Only technical elements should remain in English: URLs, code snippets, command examples, PR/issue numbers, and technical tool names.
  - All descriptive text, instructions, and explanations must be translated to the document's target language.

If any part deviates from these points, propose a correction.
```

### GitHub Actionsワークフローを用意する

GitHub Actionsワークフローを用意します。以下は私が実際に使っているワークフローの例です。

ジョブを2つに分けています。1つはIssueの作成、もう1つはCopilotエージェントのアサインです。Issueの作成とアサインを同一ジョブ内で行うと、Copilotエージェントタスクがトリガーされないため回避策としてジョブを分割しています。

起点は、document translationワークフローの`workflow_dispatch`手動実行です。[^1]手動実行すると、`issue`ジョブでドキュメント翻訳用のIssueが作成 + ラベル付与します。。Issueへのラベル付与をトリガーに、`assign`ジョブでIssueにCopilotエージェントをアサインします。あとは、Copilot Agent Taskが翻訳タスクを開始、PRを作成します。

今回は、README.md（英語）とREADME-ja.md（日本語）の翻訳を例にしていますが、環境ごとにドキュメントを調整してください。Issueに付与するラベルは`documentation`にしていますが、こちらも適宜変更してください。

```yaml
name: document translation
on:
  workflow_dispatch:
  issues:
    types: [labeled]

jobs:
  # ドキュメント翻訳イシューの作成ジョブ。ここでインストラクションする。
  issue:
    if: ${{ github.event_name == 'workflow_dispatch' }}
    permissions:
      contents: read
    runs-on: ubuntu-24.04
    timeout-minutes: 5
    steps:
      - uses: actions/create-github-app-token@29824e69f54612133e76f7eaac726eef6c875baf # v2.2.1
        id: app-token
        with:
          app-id: ${{ secrets.SYNCED_ACTIONS_BOT_APPID }}
          private-key: ${{ secrets.SYNCED_ACTIONS_BOT_PRIVATE_KEY }}
          permission-issues: write # grant write access to issues
      - name: Create Issue body
        run: |
          cat << 'EOF' > body.txt
          Apply the pull request fixes that have been applied to recently updated documents to each language's documentation.

          - README.md: English (en-us)
          - README-ja.md: Japanese (ja-jp)

          ---

          Issue created by GitHub Actions: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}
          EOF
      - name: Create issue
        run: |
          gh issue create \
            --title "[Automate] Apply the fixes from pull requests to the doc for each language." \
            --body-file body.txt \
            --label "documentation"
        env:
          GH_REPO: ${{ github.repository }}
          GH_TOKEN: ${{ steps.app-token.outputs.token }} # require trigger workflow

  # @copilotのアサインジョブを分ける
  # イシューの作成とアサインを同一ジョブ内で行うと、Copilotエージェントタスクがトリガーされない。これは想定外の挙動。
  # 回避策として、GitHub Actionsのジョブをイシュー作成とアサインで分割する。
  assign:
    if: ${{ github.event_name == 'issues' && contains(github.event.issue.labels.*.name, 'documentation') && startsWith(github.event.issue.title, '[Automate]') }}
    permissions:
      contents: read
    runs-on: ubuntu-24.04
    timeout-minutes: 5
    steps:
      - name: Assign copilot agent
        run: gh issue edit ${{ github.event.issue.number }} --add-assignee @copilot
        env:
          GH_REPO: ${{ github.repository }}
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN_COPILOT }} # require user PAT with copilot license
```

どうでもいいんですが、issueへのCopilotアサインって`@copilot`で出来るんですね。

## ドキュメント翻訳ワークフローを実行する

では、実際に実行してみましょう。
今回は、[guitarrapc/scoop-bucket](https://github.com/guitarrapc/scoop-bucket)で試します。参照用にIssueとPRも載せておきます。

- Issue: https://github.com/guitarrapc/scoop-bucket/issues/19
- PR: https://github.com/guitarrapc/scoop-bucket/pull/20

README.md(英語)に変更をいれ、README-ja.md(日本語)はその変更に追随していない、かつ未翻訳部分がある状態です。このため、本対応でREADME-ja.mdが更新されることを期待します。

起点となる、`document translation`ワークフローを手動実行(`workflow_dispatch`)します。

[f:id:guitarrapc_tech:20251224181816p:plain:alt=workflow_dispatchで実行]<!--image-1.png-->

[f:id:guitarrapc_tech:20251224181823p:plain:alt=issueジョブが実行]<!--image-3.png-->

[Issue](https://github.com/guitarrapc/scoop-bucket/issues/19)が作成され、`documentation`ラベルが付与されます。

[f:id:guitarrapc_tech:20251224181831p:plain:alt=Issue作成、documentationラベルを付与]<!--image-2.png-->

`documentation`ラベルが付与されると、再び`document translation`ワークフローがトリガーされ、今度は`assign`ジョブでIssueにCopilotエージェントがアサインされます。

[f:id:guitarrapc_tech:20251224181840p:plain:alt=issueにCopilotがアサインされる]<!--image-4.png-->

CopilotエージェントがIssue内容に基づき、ドキュメントを翻訳しPRを作成します。今回はIssueボディが次の内容なので、README.md（英語）とREADME-ja.md（日本語）で翻訳されます。

```md
Apply the pull request fixes that have been applied to recently updated documents to each language's documentation.

- README.md: English (en-us)
- README-ja.md: Japanese (ja-jp)

---

Issue created by GitHub Actions: https://github.com/guitarrapc/scoop-bucket/actions/runs/20479070004
```

[f:id:guitarrapc_tech:20251224181848p:plain:alt=CopilotがPRを作成]<!--image-5.png-->

Copilotエージェントが作成した[PR](https://github.com/guitarrapc/scoop-bucket/pull/20)は次の通りです。

[f:id:guitarrapc_tech:20251224181855p:plain:alt=翻訳対応PR]<!--image-6.png-->

ファイル差分は次の通りです。あとは、翻訳内容をレビュー、修正、マージすれば完了です。

[f:id:guitarrapc_tech:20251224181905p:plain:alt=PRのファイル差分]<!--image-7.png-->

## インストラクションでLanguage Consistencyを指示する効果

先に示したインストラクションの中で、特に`Language Consistency`の指示がおすすめです。この指示を与えることで、ドキュメント全体の言語を統一し、技術要素のみ英語のままにできます。

```md
- Language Consistency
  - Each language-specific document (e.g., README-ja.md for Japanese) must be written entirely in that language.
  - Only technical elements should remain in English: URLs, code snippets, command examples, PR/issue numbers, and technical tool names.
  - All descriptive text, instructions, and explanations must be translated to the document's target language.
```

LLMによる翻訳は、意外と文書が漏れます。
例えば、日本語文書の中に、`These elements should .....`のような英語文書が混じっていても、翻訳されずに残ってしまうことがよくあります。また、ある言語にPRで加えられた変更を他言語に反映させる場合、PRで変更されなかった箇所に異なる言語が混じっていても翻訳されず残ります。このインストラクションはそれらを防ぐ目的です。

インストラクションの効果を見てみましょう。
このインストラクションがない状態で、先ほどのワークフローを実行した結果です。差分を見ると、PRや直近コミットで変更を加えていない箇所が翻訳されずに残っています。

[f:id:guitarrapc_tech:20251224181916p:plain:alt=インストラクションを入れない場合]<!--image-8.png-->

一度PR/Issueをクローズしてから、同インストラクションを入れて、先ほどのワークフローを実行した結果です。差分を見ると、先ほど取り残されていた英語部分が日本語翻訳されていることが分かります。このインストラクションがドキュメント全体の言語統一に効果的であることが分かります。

[f:id:guitarrapc_tech:20251224181924p:plain:alt=インストラクションを入れた場合]<!--image-9.png-->

## 参考

- [ghコマンドでgithub copilotをアサインする | Zenn](https://zenn.dev/awonosuke/scraps/5e6121bea88e21)


[^1]: 任意タイミングの翻訳のためWorkflow Dispatchを使っていますが、特定ファイルへのpushトリガーなどに変更もよいでしょう。
